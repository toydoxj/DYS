# Form implementation generated from reading ui file 'DYL.ui'
#
# Created by: PyQt6 UI code generator 6.4.2
#
# WARNING: Any manual changes made to this file will be lost when pyuic6 is
# run again.  Do not edit this file unless you know what you are doing.

import io
import sys
import warnings
import json
import googlemaps 
from datetime import datetime
import os

warnings.simplefilter("ignore", UserWarning)
sys.coinit_flags = 2  # COINIT_APARTMENTTHREADED

from PyQt6 import QtCore, QtGui, QtWidgets, QtWebEngineWidgets
from PyQt6.QtCore import QPropertyAnimation, Qt
from PyQt6.QtWidgets import QAbstractItemView, QRadioButton

# Win32 모듈 import 경로 수정
current_dir = os.path.dirname(os.path.abspath(__file__))
parent_dir = os.path.dirname(current_dir)
sys.path.append(parent_dir)

try:
    from Win32.InputLoad import *
    import Win32.maketable as maketable
except ImportError as e:
    print(f"Error importing Win32 modules: {e}")
    print(f"Current sys.path: {sys.path}")
    sys.exit(1)

import pandas as pd
import rc_resource
import csv
import codecs
import folium



## 활하중 기준 읽는 함수
## CSV파일을 읽어서 대분류, 소분류 카테고리로 변환 시킴
def load_csv_data(file_path):
    df = pd.read_csv(file_path)
    data = {}
    for _, row in df.iterrows():
        category = row['대분류']
        subcategory = row['소분류']
        value = row['활하중']
        if category not in data:
            data[category] = {}
        data[category][subcategory] = value
    return data




class Ui_MainWindow(object):
    def setupUi(self, MainWindow):
        MainWindow.setObjectName("MainWindow")
        MainWindow.resize(1700,650)
        MainWindow.setWindowIcon(QtGui.QIcon('icons\icons.png'))

        page1 = Page_Info(self)
        page2 = Page_GL(self, page1)
        page3 = Page_WL(self, page1)
        page4 = Page_EL(self)
        page5 = Page_LC(self)

        # Centralwidget
        self.centralwidget = QtWidgets.QWidget(parent=MainWindow)
        self.centralwidget.setObjectName("centralwidget")
        self.centralwidget.setStyleSheet("background-color: #007e8e; \n") 
                                        
        # 1차 정렬
        self.horizontalLayout = QtWidgets.QHBoxLayout(self.centralwidget)
        self.horizontalLayout.setContentsMargins(0, 0, 0, 0)
        self.horizontalLayout.setSpacing(0)
        self.horizontalLayout.setObjectName("horizontalLayout")

        # mainbody 구성 
        self.mainbody = QtWidgets.QWidget(parent=self.centralwidget)
        self.mainbody.setObjectName("mainbody")
        self.mainbody.setStyleSheet("background-color:#fefefe;")

        # header 구성
        self.headerFrame = QtWidgets.QWidget(parent=self.mainbody)
        self.headerFrame.setMinimumSize(QtCore.QSize(0, 40))
        self.headerFrame.setObjectName("headerFrame")
        self.headerFrame.setStyleSheet("QWidget#headerFrame { border-bottom: 1px solid black; border-right: none; border-top: none; border-left: none; } QLabel#Title_Label { border: none; }\n"
                                       "QPushButton {border-color:#cfcfcf; border-style:solid; border-width: 1px;}\n"
                                       "QPushButton:hover {background-color:#007e8e; color:white ;}")
        # hearder 내용 입력
        self.horizontalLayout_header = QtWidgets.QHBoxLayout(self.headerFrame)

        # Label
        self.Title_Label = QtWidgets.QLabel(parent=self.headerFrame)
        self.Title_Label.setObjectName("Title_Label")
        self.Title_Label.setText('Project Information')
        self.Title_Label.setFixedSize(600,25)
        font = QtGui.QFont()
        font.setPointSize(16)
        font.setBold(True)
        font.setWeight(50)
        self.Title_Label.setFont(font)

        # Button
        btn_FileNew = QtWidgets.QPushButton(parent=self.headerFrame)
        btn_FileNew.setText('New')
        btn_FileNew.setFixedSize(100,25)
        btn_FileNew.clicked.connect(lambda: self.on_click_New(page1,page2))
       
        btn_FileOpen = QtWidgets.QPushButton(parent=self.headerFrame)
        btn_FileOpen.setText('Open')
        btn_FileOpen.setFixedSize(100,25)
        btn_FileOpen.clicked.connect(lambda: self.on_click_FileOpen(page1, page2))

        btn_FileSave = QtWidgets.QPushButton(parent=self.headerFrame)
        btn_FileSave.setText('Save')
        btn_FileSave.setFixedSize(100,25)
        btn_FileSave.clicked.connect(lambda: self.on_click_FileSave(page1, page2))

        btn_FileSaveAs = QtWidgets.QPushButton(parent=self.headerFrame)
        btn_FileSaveAs.setText('SaveAs')
        btn_FileSaveAs.setFixedSize(100,25)
        btn_FileSaveAs.clicked.connect(lambda: self.on_click_FileSaveAs(page1, page2))

        spacerItem_header = QtWidgets.QSpacerItem(350, 20, QtWidgets.QSizePolicy.Policy.Expanding, QtWidgets.QSizePolicy.Policy.Minimum)

        self.horizontalLayout_header.addWidget(self.Title_Label)
        self.horizontalLayout_header.addWidget(btn_FileNew)
        self.horizontalLayout_header.addWidget(btn_FileOpen)
        self.horizontalLayout_header.addWidget(btn_FileSave)
        self.horizontalLayout_header.addWidget(btn_FileSaveAs)
        self.horizontalLayout_header.addItem(spacerItem_header)
        
        
        # mainFrame 구성
        self.mainFrame = QtWidgets.QWidget(parent=self.mainbody)
        self.mainFrame.setObjectName("mainFrame")

        # Footer Frame 구성
        self.cardsFrame = QtWidgets.QWidget(parent=self.mainbody)
        self.cardsFrame.setMinimumSize(QtCore.QSize(0, 40))
        self.cardsFrame.setObjectName("cardsFrame")
        self.cardsFrame.setStyleSheet("QWidget#cardsFrame { border-top: 1px solid black; border-right: none; border-bottom: none; border-left: none; } QLabel#myLabel { border: none; }")

        # Footer 내용 입력
        self.horizontalLayout_2 = QtWidgets.QHBoxLayout(self.cardsFrame)
        self.horizontalLayout_2.setObjectName("horizontalLayout_2")

        #Copyright
        self.label_Copyright = QtWidgets.QLabel(parent=self.cardsFrame)
        font = QtGui.QFont()
        font.setPointSize(9)
        font.setBold(False)
        font.setItalic(True)
        font.setWeight(50)
        self.label_Copyright.setFont(font)
        self.label_Copyright.setLayoutDirection(QtCore.Qt.LayoutDirection.LeftToRight)
        self.label_Copyright.setAlignment(QtCore.Qt.AlignmentFlag.AlignBottom|QtCore.Qt.AlignmentFlag.AlignLeading|QtCore.Qt.AlignmentFlag.AlignLeft)
        self.label_Copyright.setObjectName("label_Copyright")

        #Spacer
        spacerItem8 = QtWidgets.QSpacerItem(350, 20, QtWidgets.QSizePolicy.Policy.Fixed, QtWidgets.QSizePolicy.Policy.Minimum)
        
        #Dongyang LOGO
        self.label_Dylogo = QtWidgets.QLabel(parent=self.cardsFrame)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Policy.Fixed, QtWidgets.QSizePolicy.Policy.Preferred)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.label_Dylogo.sizePolicy().hasHeightForWidth())
        self.label_Dylogo.setSizePolicy(sizePolicy)
        self.label_Dylogo.setMaximumSize(QtCore.QSize(130, 16777215))
        font = QtGui.QFont()
        font.setPointSize(9)
        font.setItalic(True)
        self.label_Dylogo.setFont(font)
        self.label_Dylogo.setText("")
        self.label_Dylogo.setPixmap(QtGui.QPixmap(":/logo/Icons/logo/DY-S.png"))
        self.label_Dylogo.setObjectName("label_Dylogo")
        

        self.horizontalLayout_2.addWidget(self.label_Copyright)
        self.horizontalLayout_2.addItem(spacerItem8)
        self.horizontalLayout_2.addWidget(self.label_Dylogo)

        # Frame 정렬
        self.verticalLayout = QtWidgets.QVBoxLayout(self.mainbody)
        self.verticalLayout.setObjectName("verticalLayout")
        self.verticalLayout.addWidget(self.headerFrame)
        self.verticalLayout.addWidget(self.mainFrame)
        self.verticalLayout.addWidget(self.cardsFrame)

        self.verticalLayout_3 = QtWidgets.QVBoxLayout(self.mainFrame)
        self.verticalLayout_3.setObjectName("verticalLayout_3")

        #STACK
        self.stackedWidget = QtWidgets.QStackedWidget(parent=self.mainFrame)
        self.stackedWidget.setFrameShape(QtWidgets.QFrame.Shape.Panel)
        self.stackedWidget.setLineWidth(0)
        self.stackedWidget.setObjectName("stackedWidget")
        


        self.stackedWidget.addWidget(page1)
        self.stackedWidget.addWidget(page2)
        self.stackedWidget.addWidget(page3)
        self.stackedWidget.addWidget(page4)
        self.stackedWidget.addWidget(page5)

        self.verticalLayout_3.addWidget(self.stackedWidget)

        # 좌측 Frame 함수 호출
        self.leftmargin = LeftMargin(parent=self.centralwidget) # 좌측 여백 Frame
        self.leftmargin.setObjectName('leftmargin')

        self.leftMenu = LeftMenu(parent=self.centralwidget) # 메뉴 Frame
        self.leftMenu.setObjectName('leftMenu')
        self.leftMenu.setStyleSheet("background-color:#007e8e;")
        
        # 1차 정렬
        self.horizontalLayout.addWidget(self.leftmargin)
        self.horizontalLayout.addWidget(self.leftMenu)
        self.horizontalLayout.addWidget(self.mainbody)

        MainWindow.setCentralWidget(self.centralwidget)

        self.retranslateUi(MainWindow)
        self.stackedWidget.setCurrentIndex(0)
        QtCore.QMetaObject.connectSlotsByName(MainWindow)

        # 스택간 시그널/슬롯 연결
        page1.update_address.connect(page3.txt_address.setText)

    def retranslateUi(self, MainWindow):
        _translate = QtCore.QCoreApplication.translate
        MainWindow.setWindowTitle(_translate("MainWindow", "DYL - ver0.0.2(beta)"))
        self.label_Copyright.setText(_translate("MainWindow", "Copyright 2023. Jeong Jihun, jjh@dyce.kr"))

    # 새파일 버튼 클릭
    def on_click_New(self,page1,page2):
        
        if not page2.df_load.empty or not page2.txt_FileName.text() == "":
            reply = QtWidgets.QMessageBox.question(MainWindow, '경고', '정말로 새로 만드시겠습니까? 작업된 내용은 삭제됩니다.', QtWidgets.QMessageBox.StandardButton.Ok | QtWidgets.QMessageBox.StandardButton.Cancel)

            if reply == QtWidgets.QMessageBox.StandardButton.Cancel: return
            
        page2.txt_FileName.clear()
        page2.df_load = pd.DataFrame(columns = ['ID','floor','name','f1','d1','t1','l1','f2','d2','t2','l2','f3','d3','t3','l3','f4','d4','t4','l4','f5','d5','t5','l5','f6','d6','t6','l6','SDL','Type','conthk','conLoad','DL','Category','subcategory','LR','LL','Service','Strength'])
        page2.update_table(page2.df_load)
        page1.information = {
                            'code': '',
                            'project': '',
                            'address': '',
                            'occupancy': '',
                            'area': '',
                            'sfloor': '',
                            'bfloor': '',
                            'height': '',
                            'importance': ''
                        }
        page1._init_information()

    # 파일 오픈 버튼 클릭

    def on_click_FileOpen(self, page1, page2):
        file_name, _ = QtWidgets.QFileDialog.getOpenFileName(MainWindow, "파일 선택", "", "DYL Files (*.dyl);;All Files (*)")
        if file_name:
            with open(file_name, 'r', encoding='utf-8') as file:
                lines = file.readlines()

                # DataFrame으로 데이터 저장
                data = []
                data_started = True
                end_marker = '##end_Gravity_Load'

                for line in lines:
                    line = line.strip()
                    if line == end_marker:
                        break
                    if data_started:
                        row = list(csv.reader([line]))[0]
                        data.append(row)
                
                page2.df_load = pd.DataFrame(data[1:], columns=data[0]).set_index('ID')
                page2.df_load.reset_index(inplace=True)

                # 나머지 코드 실행
                page2.txt_FileName.setText(file_name)
                page2.update_table(page2.df_load)

                
                page1.information = {}
                # 프로젝트 정보 추출
                project_info = []
                start_marker = '##Information'
                end_marker = '##end_information'

                for line in lines:
                    line = line.strip()
                    if line == end_marker:
                        break
                    if ':' in line:
                        key, value = line.split(':')
                        page1.information[key] = value
                print(page1.information)
                page1._update_information()




    # 파일 저장 버튼 클릭
    def on_click_FileSave(self,page1,page2):

        if page2.txt_FileName.text() == "":
            self.on_click_FileSaveAs(page1, page2)
            return
        
        try : 
            file_name = page2.txt_FileName.text()
            page2.df_load.to_csv(file_name, index=False, encoding='utf-8')
                                    
            with codecs.open(file_name, 'a', encoding='utf-8')as file:
                writer = csv.writer(file)
                writer.writerow(['##end_Gravity_Load'])
                writer.writerow(['##Information'])
                for key, value in page1.information.items():
                    writer.writerow([f'{key}:{value}'])
                writer.writerow(['##end_information'])
                
            page2.txt_FileName.setText(file_name)
            QtWidgets.QMessageBox.information(None, '확인', '저장하였습니다.')
        except PermissionError:
            msg = QtWidgets.QMessageBox()
            msg.setText("저장오류")
            msg.setInformativeText(f"Failed to save file {file_name}.\n열려있는 파일을 닫아주세요.")
            msg.setFixedSize(800,100)
            msg.setWindowTitle("Error")
            msg.exec() 
        
    # 새이름 저장 버튼 클릭
    def on_click_FileSaveAs(self, page1, page2):
        
        file_name, _ = QtWidgets.QFileDialog.getSaveFileName(MainWindow, "파일 선택", "", "DYL Files (*.dyl);;All Files (*)")
        page2.txt_FileName.setText(file_name)
        if file_name:
            try : 
                page2.df_load.to_csv(file_name, index=False, encoding='utf-8')
                                     
                with codecs.open(file_name, 'a', encoding='utf-8')as file:
                    writer = csv.writer(file)
                    writer.writerow(['##end_Gravity_Load'])
                    writer.writerow(['##Information'])                    
                    for key, value in page1.information.items():
                        writer.writerow([f'{key}:{value}'])
                    writer.writerow(['##end_information'])
                 
                page2.txt_FileName.setText(file_name)
                QtWidgets.QMessageBox.information(None, '확인', '저장하였습니다.')
            except PermissionError:
                msg = QtWidgets.QMessageBox()
                msg.setText("저장오류")
                msg.setInformativeText(f"Failed to save file {file_name}.\n열려있는 파일을 닫아주세요.")
                msg.setFixedSize(800,100)
                msg.setWindowTitle("Error")
                msg.exec() 

    

class LeftMargin(QtWidgets.QWidget):
    ''' 
    좌측 여백 
    폭 20px
    '''
    def __init__(self, parent=None):
        super().__init__(parent)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Policy.Fixed, QtWidgets.QSizePolicy.Policy.Preferred)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.sizePolicy().hasHeightForWidth())
        self.setStyleSheet(' background-color: #007e8e; ')
        self.setSizePolicy(sizePolicy)
        self.setMinimumSize(QtCore.QSize(20, 0))
        self.setMaximumSize(QtCore.QSize(20, 16777215))


class LeftMenu(QtWidgets.QWidget):
    ''' 
    메뉴창
    '''
    def __init__(self, parent=None):
        super().__init__(parent)
        self.stackedWidget = parent.findChild(QtWidgets.QStackedWidget, "stackedWidget")
        self.label = parent.findChild(QtWidgets.QLabel, "Title_Label")
        
        self.setMinimumSize(QtCore.QSize(40, 0))
        self.setMaximumSize(QtCore.QSize(40, 16777215))
        self.Anim_menu()
        self.setStyleSheet("QPushButton { background-color:#007e8e; border-style:solid; text-align: left; color:#fefeff; padding:5px; }\n"
                            "QPushButton#BtnGL:hover{ border-color:#fefeff; border-style:solid; border-width: 2px; \n"
                                                            " text-align: left; color:#000000; padding:5px; }\n"
                                    "QPushButton#BtnWL:hover{  border-color:#fefeff; border-style:solid; border-width: 2px; \n"
                                                            " text-align: left; color:#000000; padding:5px; }\n"
                                    "QPushButton#BtnEL:hover{  border-color:#fefeff; border-style:solid; border-width: 2px; \n"
                                                            "; text-align: left; color:#000000; padding:5px; }\n"
                                    "QPushButton#BtnLC:hover{  border-color:#fefeff; border-style:solid; border-width: 2px; \n"
                                                            " text-align: left; color:#000000; padding:5px; }\n"
                                    "QPushButton#BtnInfo:hover{ border-color:#fefeff; border-style:solid; border-width: 2px; \n"                                    
                                                            " text-align: left; color:#000000; padding:5px; }")

        
        self.verticalLayout_2 = QtWidgets.QVBoxLayout(self)
        self.verticalLayout_2.setContentsMargins(0, 0, 0, 0)
        self.verticalLayout_2.setSpacing(0)
        self.verticalLayout_2.setObjectName("verticalLayout_2")

        spacerItem = QtWidgets.QSpacerItem(20, 10, QtWidgets.QSizePolicy.Policy.Minimum, QtWidgets.QSizePolicy.Policy.Fixed)
        self.verticalLayout_2.addItem(spacerItem)

        # 메뉴 펼침 버튼
        self.BtnMenu = QtWidgets.QPushButton(parent=self)
        self.BtnMenu.clicked.connect(self.Anim_menu)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Policy.Minimum, QtWidgets.QSizePolicy.Policy.Fixed)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.BtnMenu.sizePolicy().hasHeightForWidth())

        self.BtnMenu.setSizePolicy(sizePolicy)
        self.BtnMenu.setMinimumSize(QtCore.QSize(0, 50))
        self.BtnMenu.setMaximumSize(QtCore.QSize(16777215, 50))

        font = QtGui.QFont()
        font.setPointSize(11)
        font.setBold(True)
        font.setWeight(75)
        self.BtnMenu.setFont(font)
        self.BtnMenu.setContextMenuPolicy(QtCore.Qt.ContextMenuPolicy.PreventContextMenu)
        icon = QtGui.QIcon()
        icon.addPixmap(QtGui.QPixmap(":/White_Icon/Icons/white/iconmonstr-menu-1-240 (1).png"), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
        self.BtnMenu.setIcon(icon)
        self.BtnMenu.setIconSize(QtCore.QSize(24, 24))
        self.BtnMenu.setObjectName("BtnMenu")
        self.verticalLayout_2.addWidget(self.BtnMenu)

        # Sapcer
        spacerItem1 = QtWidgets.QSpacerItem(20, 20, QtWidgets.QSizePolicy.Policy.Minimum, QtWidgets.QSizePolicy.Policy.Fixed)
        self.verticalLayout_2.addItem(spacerItem1)
        self.BtnGL = QtWidgets.QPushButton(parent=self)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Policy.Minimum, QtWidgets.QSizePolicy.Policy.Maximum)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.BtnGL.sizePolicy().hasHeightForWidth())

        # 수직하중 버튼
        self.BtnGL.setSizePolicy(sizePolicy)
        self.BtnGL.setMaximumSize(QtCore.QSize(16777215, 30))
        self.BtnGL.setBaseSize(QtCore.QSize(0, 0))
        font = QtGui.QFont()
        font.setPointSize(11)
        font.setBold(True)
        font.setWeight(75)
        self.BtnGL.setFont(font)
        icon1 = QtGui.QIcon()
        icon1.addPixmap(QtGui.QPixmap(":/White_Icon/Icons/white/iconmonstr-construction-10-240.png"), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
        self.BtnGL.setIcon(icon1)
        self.BtnGL.setIconSize(QtCore.QSize(24, 24))
        self.BtnGL.setObjectName("BtnGL")
        self.BtnGL.clicked.connect(lambda: self.change_widget(1))
        self.verticalLayout_2.addWidget(self.BtnGL)

        # Spacer
        spacerItem2 = QtWidgets.QSpacerItem(20, 10, QtWidgets.QSizePolicy.Policy.Minimum, QtWidgets.QSizePolicy.Policy.Fixed)
        self.verticalLayout_2.addItem(spacerItem2)

        # 풍하중 버튼
        self.BtnWL = QtWidgets.QPushButton(parent=self)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Policy.Minimum, QtWidgets.QSizePolicy.Policy.Fixed)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.BtnWL.sizePolicy().hasHeightForWidth())
        self.BtnWL.setSizePolicy(sizePolicy)
        font = QtGui.QFont()
        font.setPointSize(11)
        font.setBold(True)
        font.setWeight(75)
        self.BtnWL.setFont(font)
        icon2 = QtGui.QIcon()
        icon2.addPixmap(QtGui.QPixmap(":/White_Icon/Icons/white/iconmonstr-weather-64-240.png"), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
        self.BtnWL.setIcon(icon2)
        self.BtnWL.setIconSize(QtCore.QSize(24, 24))
        self.BtnWL.setObjectName("BtnWL")
        self.BtnWL.clicked.connect(lambda: self.change_widget(2))
        self.verticalLayout_2.addWidget(self.BtnWL)

        # Spacer
        spacerItem3 = QtWidgets.QSpacerItem(20, 10, QtWidgets.QSizePolicy.Policy.Minimum, QtWidgets.QSizePolicy.Policy.Fixed)
        self.verticalLayout_2.addItem(spacerItem3)

        # 지진하중 버튼
        self.BtnEL = QtWidgets.QPushButton(parent=self)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Policy.Minimum, QtWidgets.QSizePolicy.Policy.Fixed)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.BtnEL.sizePolicy().hasHeightForWidth())
        self.BtnEL.setSizePolicy(sizePolicy)
        font = QtGui.QFont()
        font.setPointSize(11)
        font.setBold(True)
        font.setWeight(75)
        self.BtnEL.setFont(font)
        icon3 = QtGui.QIcon()
        icon3.addPixmap(QtGui.QPixmap(":/White_Icon/Icons/white/iconmonstr-sound-wave-8-240.png"), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
        self.BtnEL.setIcon(icon3)
        self.BtnEL.setIconSize(QtCore.QSize(24, 24))
        self.BtnEL.setObjectName("BtnEL")
        self.BtnEL.clicked.connect(lambda: self.change_widget(3))
        self.verticalLayout_2.addWidget(self.BtnEL)

        # Spacer
        spacerItem4 = QtWidgets.QSpacerItem(20, 10, QtWidgets.QSizePolicy.Policy.Minimum, QtWidgets.QSizePolicy.Policy.Fixed)
        self.verticalLayout_2.addItem(spacerItem4)
        
        # LoadCombination 버튼
        self.BtnLC = QtWidgets.QPushButton(parent=self)
        font = QtGui.QFont()
        font.setPointSize(11)
        font.setBold(True)
        font.setWeight(75)
        self.BtnLC.setFont(font)
        icon4 = QtGui.QIcon()
        icon4.addPixmap(QtGui.QPixmap(":/White_Icon/Icons/white/iconmonstr-inbox-17-240.png"), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
        self.BtnLC.setIcon(icon4)
        self.BtnLC.setIconSize(QtCore.QSize(24, 24))
        self.BtnLC.setObjectName("BtnLC")
        self.BtnLC.clicked.connect(lambda: self.change_widget(4))
        self.verticalLayout_2.addWidget(self.BtnLC)

        # Spacer
        spacerItem5 = QtWidgets.QSpacerItem(20, 40, QtWidgets.QSizePolicy.Policy.Minimum, QtWidgets.QSizePolicy.Policy.Expanding)
        self.verticalLayout_2.addItem(spacerItem5)

        # Information 버튼
        self.BtnInfo = QtWidgets.QPushButton(parent=self)
        sizePolicy = QtWidgets.QSizePolicy(QtWidgets.QSizePolicy.Policy.Minimum, QtWidgets.QSizePolicy.Policy.Fixed)
        sizePolicy.setHorizontalStretch(0)
        sizePolicy.setVerticalStretch(0)
        sizePolicy.setHeightForWidth(self.BtnInfo.sizePolicy().hasHeightForWidth())
        self.BtnInfo.setSizePolicy(sizePolicy)
        self.BtnInfo.setBaseSize(QtCore.QSize(0, 30))
        font = QtGui.QFont()
        font.setPointSize(11)
        font.setBold(True)
        font.setWeight(75)
        self.BtnInfo.setFont(font)
        icon5 = QtGui.QIcon()
        icon5.addPixmap(QtGui.QPixmap(":/White_Icon/Icons/white/iconmonstr-gear-thin-240.png"), QtGui.QIcon.Mode.Normal, QtGui.QIcon.State.Off)
        self.BtnInfo.setIcon(icon5)
        self.BtnInfo.setIconSize(QtCore.QSize(24, 24))
        self.BtnInfo.setObjectName("BtnInfo")
        self.BtnInfo.clicked.connect(lambda: self.change_widget(0))
        self.verticalLayout_2.addWidget(self.BtnInfo)

        # Spacer
        spacerItem6 = QtWidgets.QSpacerItem(20, 10, QtWidgets.QSizePolicy.Policy.Minimum, QtWidgets.QSizePolicy.Policy.Fixed)
        self.verticalLayout_2.addItem(spacerItem6)

        self.retranslateUi(MainWindow)

    def retranslateUi(self, MainWidow):
        _translate = QtCore.QCoreApplication.translate
        self.BtnMenu.setText(_translate("MainWindow", "  DYL"))
        self.BtnGL.setText(_translate("MainWindow", "  Gravity Load"))
        self.BtnWL.setText(_translate("MainWindow", "  Wind Load"))
        self.BtnEL.setText(_translate("MainWindow", "  Seismic Load"))
        self.BtnLC.setText(_translate("MainWindow", "  Load Combination"))
        self.BtnInfo.setText(_translate("MainWindow", " Project Information"))

    def Anim_menu(self):
        width = self.width()
        normal = 40
        if width == normal:
            extender = 210            
        else:
            extender = normal
        self.anim = QPropertyAnimation(self, b"minimumWidth")  # 속성 이름을 변경한 변수를 사용합니다.
        self.anim.setDuration(100)
        self.anim.setStartValue(width)
        self.anim.setEndValue(extender)
        self.anim.start()

    def change_widget(self, index):
        self.stackedWidget.setCurrentIndex(index)
        if index == 0: self.label.setText("Project Information")
        if index == 1: self.label.setText("Gravity Load")
        if index == 2: self.label.setText("Wind Load")
        if index == 3: self.label.setText("Seismic Load")
        if index == 4: self.label.setText("Load Combination")


# 각 스탯의 클래스

class Page_Info(QtWidgets.QWidget):
    update_address = QtCore.pyqtSignal(str) #다른 page에 시그널을 보내기 위한 변수.


    def __init__(self, main_window, parent=None):
        self.main_window = main_window
        self.information = {
                            'code': '',
                            'project': '',
                            'address': '',
                            'occupancy': '',
                            'area': '',
                            'sfloor': '',
                            'bfloor': '',
                            'height': '',
                            'importance': ''
                        }

        super().__init__(parent)

        self.horizontalLayout_pageinfo = QtWidgets.QHBoxLayout(self)
        
        # Label Frame
        self.frame_label = QtWidgets.QFrame(parent=self)
        self.frame_label.setMinimumSize(QtCore.QSize(120, 0))
        self.frame_label.setMaximumSize(QtCore.QSize(120, 16777215))
        self.frame_label.setFrameShape(QtWidgets.QFrame.Shape.StyledPanel)
        self.frame_label.setFrameShadow(QtWidgets.QFrame.Shadow.Raised)

        self.verticalLayout_label = QtWidgets.QVBoxLayout(self.frame_label)

        self.label_code = self.create_label()
        self.label_project = self.create_label()
        self.label_address = self.create_label()
        self.label_occup = self.create_label()
        self.label_area = self.create_label()
        self.label_sfloor = self.create_label()
        self.label_bfloor = self.create_label()
        self.label_height = self.create_label()
        self.label_importance = self.create_label()

        spacerItem6 = QtWidgets.QSpacerItem(20, 169, QtWidgets.QSizePolicy.Policy.Minimum, QtWidgets.QSizePolicy.Policy.Expanding)
                
        self.verticalLayout_label.addWidget(self.label_code)
        self.verticalLayout_label.addWidget(self.label_project)
        self.verticalLayout_label.addWidget(self.label_address)
        self.verticalLayout_label.addWidget(self.label_occup)
        self.verticalLayout_label.addWidget(self.label_area)
        self.verticalLayout_label.addWidget(self.label_sfloor)
        self.verticalLayout_label.addWidget(self.label_bfloor)
        self.verticalLayout_label.addWidget(self.label_height)
        self.verticalLayout_label.addWidget(self.label_importance)
        self.verticalLayout_label.addItem(spacerItem6)

        self.frame_txtbox = QtWidgets.QFrame(parent=self)
        self.frame_txtbox.setMinimumSize(QtCore.QSize(450, 0))
        self.frame_txtbox.setMaximumSize(QtCore.QSize(450, 16777215))
        self.frame_txtbox.setFrameShape(QtWidgets.QFrame.Shape.StyledPanel)
        self.frame_txtbox.setFrameShadow(QtWidgets.QFrame.Shadow.Raised)

        self.verticalLayout_txtbox = QtWidgets.QVBoxLayout(self.frame_txtbox)

        self.lineEdit_code = self.create_lineedit()
        self.lineEdit_project = self.create_lineedit()
        self.lineEdit_address = self.create_lineedit()
        self.lineEdit_occup = self.create_lineedit()
        self.lineEdit_area = self.create_lineedit()
        self.lineEdit_height = self.create_lineedit()
        self.lineEdit_sfloor = self.create_lineedit()
        self.lineEdit_bfloor = self.create_lineedit()
        self.lineEdit_importance = self.create_lineedit()

        self.lineEdit_code.textChanged.connect(lambda: self._set_information(0))
        self.lineEdit_project.textChanged.connect(lambda: self._set_information(1))
        self.lineEdit_address.textChanged.connect(lambda: self._set_information(2))
        self.lineEdit_occup.textChanged.connect(lambda: self._set_information(3))
        self.lineEdit_area.textChanged.connect(lambda: self._set_information(4))
        self.lineEdit_sfloor.textChanged.connect(lambda: self._set_information(5))
        self.lineEdit_bfloor.textChanged.connect(lambda: self._set_information(6))
        self.lineEdit_height.textChanged.connect(lambda: self._set_information(7))
        self.lineEdit_importance.textChanged.connect(lambda: self._set_information(8))

        spacerItem7 = QtWidgets.QSpacerItem(20, 169, QtWidgets.QSizePolicy.Policy.Minimum, QtWidgets.QSizePolicy.Policy.Expanding)
        
        self.verticalLayout_txtbox.addWidget(self.lineEdit_code)
        self.verticalLayout_txtbox.addWidget(self.lineEdit_project)
        self.verticalLayout_txtbox.addWidget(self.lineEdit_address)
        self.verticalLayout_txtbox.addWidget(self.lineEdit_occup)
        self.verticalLayout_txtbox.addWidget(self.lineEdit_area)
        self.verticalLayout_txtbox.addWidget(self.lineEdit_height)
        self.verticalLayout_txtbox.addWidget(self.lineEdit_sfloor)
        self.verticalLayout_txtbox.addWidget(self.lineEdit_bfloor)
        self.verticalLayout_txtbox.addWidget(self.lineEdit_importance)
        self.verticalLayout_txtbox.addItem(spacerItem7)

        self.frame_vbox = QtWidgets.QFrame(parent=self)
        self.frame_vbox.setFrameShape(QtWidgets.QFrame.Shape.StyledPanel)
        self.frame_vbox.setFrameShadow(QtWidgets.QFrame.Shadow.Raised)
        self.verticalLayout_vbox = QtWidgets.QVBoxLayout(self.frame_vbox)
        self.textBrowser = QtWidgets.QTextBrowser(parent=self.frame_vbox)
        self.verticalLayout_vbox.addWidget(self.textBrowser)

        self.horizontalLayout_pageinfo.addWidget(self.frame_label)
        self.horizontalLayout_pageinfo.addWidget(self.frame_txtbox)
        self.horizontalLayout_pageinfo.addWidget(self.frame_vbox)

        self.retranslateUi(MainWindow)

    def create_label(self):
        style_sheet = "QLineEdit {background-color: #cfcfcf; border: 1px solid #cccccc;} "
        label = QtWidgets.QLabel(parent=self.frame_label)
        font = QtGui.QFont()
        font.setFamily("굴림")
        font.setPointSize(11)
        font.setBold(True)
        font.setWeight(75)
        label.setFont(font)
        label.setStyleSheet(style_sheet)
        label.setFixedSize(100,25)
        return label
    
    def create_lineedit(self):
        style_sheet = "QLineEdit { border: 1px solid #cccccc;} "
        line_edit = QtWidgets.QLineEdit(parent=self.frame_txtbox)
        font = QtGui.QFont()
        font.setFamily("맑은 고딕")
        font.setPointSize(11)
        font.setBold(True)
        font.setWeight(75)
        line_edit.setFont(font)
        line_edit.setStyleSheet(style_sheet)
        line_edit.setFixedSize(300,25)
        return line_edit

    def retranslateUi(self, MainWidow):
        _translate = QtCore.QCoreApplication.translate
        self.label_code.setText(_translate("MainWindow", "Project Code"))
        self.label_project.setText(_translate("MainWindow", "용역명"))
        self.label_address.setText(_translate("MainWindow", "주소"))
        self.label_occup.setText(_translate("MainWindow", "용도"))
        self.label_area.setText(_translate("MainWindow", "연면적"))
        self.label_height.setText(_translate("MainWindow", "높이"))
        self.label_sfloor.setText(_translate("MainWindow", "지상층수"))
        self.label_bfloor.setText(_translate("MainWindow", "지하층수"))
        self.label_importance.setText(_translate("MainWindow", "중요도"))
        self.textBrowser.setHtml(_translate("MainWindow", 
                                            "<html><head><meta name=\"qrichtext\" content=\"1\" /><style type=\"text/css\">\n"
                                            "p, li { white-space: pre-wrap; }\n"
                                            "</style></head><body style=\" font-family:\'Gulim\'; font-size:9pt; font-weight:400; font-style:normal;\">\n"
                                            "<p> <span style=\" font-size:16pt; font-weight:600;\"><br>DYL - 하중관리 프로그램</span></p>\n"
                                            "<p> <span style=\" font-size:16px; font-weight:600; color:#a60000;\"><br />현재 주요기능</span></p>\n"
                                            "<p>1. 하중 파일을 저장하고 읽습니다. (확장자는 dyl로 저장됨)</p>\n"
                                            "<p>2. 하중 DATA를 등록, 수정, 삭제, 화살표를 이용해서 정렬가능</p>\n"
                                            "<p>3. 자동으로 EXCEL하중표 작성</p>\n"
                                            "<p>4. 자동으로 MiDAS/Gen으로 하중입력</p>\n"
                                            "<hr />\n"
                                            "<p><span style=\" font-size:16px; font-weight:600; color:#a60000;\"><br />사용 시 주요 사항</span></p>\n"
                                            "<ul style=\"-qt-list-indent: 1;\">"
                                            "<li style=\"-qt-block-indent:0;\"><p>'중요' Gen Export를 위해서는 관리자 권한으로 실행할 것.\n</p></li>"
                                            "<li style=\"-qt-block-indent:0;\"><p>Gen 파일은 가급적 입력하고자 하는 파일 1개만 열어 놓는 것이 좋음\n</p></li>"
                                            "<li style=\"-qt-block-indent:0;\"><p>Gen 파일명 입력은 창 구분을 위한 것으로 다른 파일과 구분할 수 있도록 몇자만 적어두면 됨.\n</p></li>"
                                            "<li style=\"-qt-block-indent:0;\"><p>매크로 돌아갈 때 안내창 뜰 때까지 가급적 다른 작업을 하지 말 것 (Excel, MiDAS Import)</p></li></ul>\n"
                                            "<hr />\n"
                                            "<p><span style=\" font-size:16px; font-weight:600; color:#a60000;\"><br />Release Note : ver0.2(beta)</span></p>\n"
                                            "<ul style=\"-qt-list-indent: 1;\">"
                                            "<li style=\"-qt-block-indent:0;\"><p>UI개선(추후 기능 추가를 위한 선작업)\n</p></li>"
                                            "<li style=\"-qt-block-indent:0;\"><p>계단하중 입력 기능 추가\n</p></li>"
                                            "<li style=\"-qt-block-indent:0;\"><p>지붕활하중을 구분하여 Gen으로 Export\n</p></li>"
                                            "<li style=\"-qt-block-indent:0;\"><p>Gen Export 시 자동으로 저장하기 기능 추가함.(가끔 튕길 때가 있어 대비함)\n</p></li>"
                                            "</ul>\n"
                                            "<hr />\n"))

    def _set_information(self, n):
        if n == 0 : self.information['code']= self.lineEdit_code.text()
        if n == 1 : self.information['project']=self.lineEdit_project.text()
        if n == 2 : 
            self.information['address']= self.lineEdit_address.text()
            self.update_address.emit(self.information['address'])
        if n == 3 : self.information['occupancy']=self.lineEdit_occup.text()
        if n == 4 : self.information['area']= self.lineEdit_area.text() 
        if n == 5 : self.information['sfloor']=self.lineEdit_sfloor.text()
        if n == 6 : self.information['bfloor']=self.lineEdit_bfloor.text()
        if n == 7 : self.information['height']=self.lineEdit_height.text()
        if n == 8 : self.information['importance']=self.lineEdit_importance.text()

    def _init_information(self):
        self.lineEdit_code.setText('')
        self.lineEdit_project.setText('')
        self.lineEdit_address.setText('')
        self.lineEdit_occup.setText('')
        self.lineEdit_area.setText('')
        self.lineEdit_sfloor.setText('')
        self.lineEdit_bfloor.setText('')
        self.lineEdit_height.setText('')
        self.lineEdit_importance.setText('')

    def _update_information(self):
        self.lineEdit_code.setText(self.information.get('code', ''))
        self.lineEdit_project.setText(self.information.get('project', ''))
        self.lineEdit_address.setText(self.information.get('address', ''))
        self.lineEdit_occup.setText(self.information.get('occupancy', ''))
        self.lineEdit_area.setText(self.information.get('area', ''))
        self.lineEdit_sfloor.setText(self.information.get('sfloor', ''))
        self.lineEdit_bfloor.setText(self.information.get('bfloor', ''))
        self.lineEdit_height.setText(self.information.get('height', ''))
        self.lineEdit_importance.setText(self.information.get('importance', ''))


class Page_GL(QtWidgets.QWidget):
    def __init__(self, main_window, information, parent=None):
        self.main_window = main_window
        self.information = information


        super().__init__(parent)

        

        # 높이값을 변수로 정하여 수정시 용이하게 함. (Layout을 쓰지 않고 setFixedSize로 정렬하기 위함)
        Hpoint = [10,40,80,110,140,170,200,230,260,290,320,350,380,410,450]
        Vpoint = [10,120,230,340,450,600,710,820,930,1040,1150,1260,1370]

        # DATAFRAME선언
        self.df_load = pd.DataFrame(columns = ['ID','floor','name','f1','d1','t1','l1','f2','d2','t2','l2','f3','d3','t3','l3','f4','d4','t4','l4','f5','d5','t5','l5','f6','d6','t6','l6','SDL','Type','conthk','conLoad','DL','Category','subcategory','LR','LL','Service','Strength'])
        # 실수 값이 적절히 입력되어 있는지 확인
        self.validator = QtGui.QDoubleValidator()
        
        # LineEdit를 Label과 같이 만들기 위한 스타일시트
        style_sheet1 = "QLineEdit {background-color: #7d7d7d; color: #ffffff; border: none;} "
        style_sheet2 = "QLineEdit {background-color: #cfcfcf; border: 1px solid #777777;} "
        self.setStyleSheet("QPushButton {border-color:#cfcfcf; border-style:solid; border-width: 1px;}\n"
                           "QPushButton:hover {background-color:#007e8e; color:white ;}")

        # ID표기
        self.txt_id = QtWidgets.QLineEdit(self)
        self.txt_id.move(Vpoint[6],Hpoint[0])
        self.txt_id.setFixedSize(40,25)
        self.txt_id.setReadOnly(True)
        self.txt_id.setVisible(False)


        # 하중 Table
        self.tbl_Load = QtWidgets.QTableWidget(self)
        self.tbl_Load.move(Vpoint[5],Hpoint[1])
        self.tbl_Load.setRowCount(1)
        self.tbl_Load.setColumnCount(9)
        self.tbl_Load.setFixedSize(800,365)

        self.list_values = ['ID','층수','실명','용도', '슬래브두께','고정하중','활하중','D+L', '1.2D+1.6L']

        self.tbl_Load.setHorizontalHeaderLabels(self.list_values)
        self.tbl_Load.setEditTriggers(QAbstractItemView.EditTrigger.NoEditTriggers)

        self.tbl_Load.setColumnWidth(0, 0)
        self.tbl_Load.setColumnWidth(1, 80)
        self.tbl_Load.setColumnWidth(2, 120)
        self.tbl_Load.setColumnWidth(3, 180)
        self.tbl_Load.setColumnWidth(4, 80)
        self.tbl_Load.setColumnWidth(5, 80)
        self.tbl_Load.setColumnWidth(6, 80)
        self.tbl_Load.setColumnWidth(7, 80)
        self.tbl_Load.setColumnWidth(8, 80)
        
        self.tbl_Load.verticalHeader().setVisible(False)
        self.tbl_Load.setSelectionBehavior(QAbstractItemView.SelectionBehavior.SelectRows)  # 행 전체 선택
        self.tbl_Load.cellClicked.connect(self.handle_cell_click) # 시그널

        # btn_FileNew = QtWidgets.QPushButton(self)
        # btn_FileNew.setText('New')
        # btn_FileNew.move(Vpoint[0],Hpoint[0])
        # btn_FileNew.setFixedSize(100,25)
        # btn_FileNew.clicked.connect(on_click_New)
       
        # btn_FileOpen = QtWidgets.QPushButton(self)
        # btn_FileOpen.setText('Open')
        # btn_FileOpen.move(Vpoint[1],Hpoint[0])
        # btn_FileOpen.setFixedSize(100,25)
        # btn_FileOpen.clicked.connect(on_click_FileOpen)

        # btn_FileSave = QtWidgets.QPushButton(self)
        # btn_FileSave.setText('Save')
        # btn_FileSave.move(Vpoint[2],Hpoint[0])
        # btn_FileSave.setFixedSize(100,25)
        # btn_FileSave.clicked.connect(on_click_FileSave)

        # btn_FileSaveAs = QtWidgets.QPushButton(self)
        # btn_FileSaveAs.setText('SaveAs')
        # btn_FileSaveAs.move(Vpoint[3],Hpoint[0])
        # btn_FileSaveAs.setFixedSize(100,25)
        # btn_FileSaveAs.clicked.connect(on_click_FileSaveAs)

        self.txt_FileName = QtWidgets.QLineEdit(self)
        self.txt_FileName.move(Vpoint[4],Hpoint[0])
        self.txt_FileName.setFixedSize(320,25)
        self.txt_FileName.setReadOnly(True)
        self.txt_FileName.clear()
        self.txt_FileName.setVisible(False)
 
        lb_floor = QtWidgets.QLineEdit(self)
        lb_floor.setText('층수')
        lb_floor.move(Vpoint[0],Hpoint[1])
        lb_floor.setFixedSize(100,25)
        lb_floor.setReadOnly(True)
        lb_floor.setAlignment(Qt.AlignmentFlag.AlignCenter)
        lb_floor.setStyleSheet(style_sheet1)
        lb_floor.setFocusPolicy(Qt.FocusPolicy.NoFocus)

        self.txt_floor = QtWidgets.QLineEdit(self)
        self.txt_floor.move(Vpoint[1],Hpoint[1])
        self.txt_floor.setFixedSize(100,25)   
   
        lb_name = QtWidgets.QLineEdit(self)
        lb_name.setText('실명')
        lb_name.move(Vpoint[2],Hpoint[1])
        lb_name.setFixedSize(100,25)
        lb_name.setReadOnly(True)
        lb_name.setAlignment(Qt.AlignmentFlag.AlignCenter)
        lb_name.setStyleSheet(style_sheet1)
        lb_name.setFocusPolicy(Qt.FocusPolicy.NoFocus)

        self.txt_name = QtWidgets.QLineEdit(self)
        self.txt_name.move(Vpoint[3],Hpoint[1])
        self.txt_name.setFixedSize(210,25)

        # 여기부터는 마감하중 셋팅 구간
        lb_sDL = QtWidgets.QLineEdit(self)
        lb_sDL.setText('마감하중')
        lb_sDL.move(Vpoint[0],Hpoint[2])
        lb_sDL.setFixedSize(100,235)
        lb_sDL.setReadOnly(True)
        lb_sDL.setAlignment(Qt.AlignmentFlag.AlignCenter)
        lb_sDL.setStyleSheet(style_sheet1)
        lb_sDL.setFocusPolicy(Qt.FocusPolicy.NoFocus)
     
        
        lb_finish = QtWidgets.QLineEdit(self)
        lb_finish.setText('재료마감')
        lb_finish.move(Vpoint[1],Hpoint[2])
        lb_finish.setFixedSize(100,25)
        lb_finish.setReadOnly(True)
        lb_finish.setAlignment(Qt.AlignmentFlag.AlignCenter)
        lb_finish.setStyleSheet(style_sheet2)
        lb_finish.setFocusPolicy(Qt.FocusPolicy.NoFocus)

        lb_density = QtWidgets.QLineEdit(self)
        lb_density.setText('밀도(kN/㎥)')
        lb_density.move(Vpoint[2],Hpoint[2])
        lb_density.setFixedSize(100,25)
        lb_density.setReadOnly(True)
        lb_density.setAlignment(Qt.AlignmentFlag.AlignCenter)
        lb_density.setStyleSheet(style_sheet2)
        lb_density.setFocusPolicy(Qt.FocusPolicy.NoFocus)

        lb_thk = QtWidgets.QLineEdit(self)
        lb_thk.setText('두께(mm)')
        lb_thk.move(Vpoint[3],Hpoint[2])
        lb_thk.setFixedSize(100,25)
        lb_thk.setReadOnly(True)
        lb_thk.setAlignment(Qt.AlignmentFlag.AlignCenter)
        lb_thk.setStyleSheet(style_sheet2)
        lb_thk.setFocusPolicy(Qt.FocusPolicy.NoFocus)

        lb_load = QtWidgets.QLineEdit(self)
        lb_load.setText('하중(kN/㎡)')
        lb_load.move(Vpoint[4],Hpoint[2])
        lb_load.setFixedSize(100,25)
        lb_load.setReadOnly(True)
        lb_load.setAlignment(Qt.AlignmentFlag.AlignCenter)
        lb_load.setStyleSheet(style_sheet2)    
        lb_load.setFocusPolicy(Qt.FocusPolicy.NoFocus)

        self.txt_finish1 = QtWidgets.QLineEdit(self)
        self.txt_finish1.move(Vpoint[1],Hpoint[3])
        self.txt_finish1.setFixedSize(100,25)
        self.txt_finish1.setAlignment(Qt.AlignmentFlag.AlignCenter)
        
        self.txt_density1 = QtWidgets.QLineEdit(self)
        self.txt_density1.move(Vpoint[2],Hpoint[3])
        self.txt_density1.setFixedSize(100,25)
        self.txt_density1.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.txt_density1.setValidator(self.validator)
        self.txt_density1.textChanged.connect(self.update_load1)
        
        self.txt_thk1 = QtWidgets.QLineEdit(self)
        self.txt_thk1.setFixedSize(100,25)
        self.txt_thk1.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.txt_thk1.move(Vpoint[3],Hpoint[3])
        self.txt_thk1.setValidator(self.validator)
        self.txt_thk1.textChanged.connect(self.update_load1)
        
        self.txt_load1 = QtWidgets.QLineEdit(self)
        self.txt_load1.move(Vpoint[4],Hpoint[3])
        self.txt_load1.setFixedSize(100,25)
        self.txt_load1.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.txt_load1.textChanged.connect(self.update_sLoad)
        self.txt_load1.textEdited.connect(self.clear_load1)

        self.txt_finish2 = QtWidgets.QLineEdit(self)
        self.txt_finish2.move(Vpoint[1],Hpoint[4])
        self.txt_finish2.setFixedSize(100,25)
        self.txt_finish2.setAlignment(Qt.AlignmentFlag.AlignCenter)
        
        self.txt_density2 = QtWidgets.QLineEdit(self)
        self.txt_density2.move(Vpoint[2],Hpoint[4])
        self.txt_density2.setFixedSize(100,25)
        self.txt_density2.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.txt_density2.setValidator(self.validator)
        self.txt_density2.textChanged.connect(self.update_load2)
        
        self.txt_thk2 =QtWidgets.QLineEdit(self)
        self.txt_thk2.setFixedSize(100,25)
        self.txt_thk2.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.txt_thk2.move(Vpoint[3],Hpoint[4])
        self.txt_thk2.setValidator(self.validator)
        self.txt_thk2.textChanged.connect(self.update_load2)
        
        self.txt_load2 = QtWidgets.QLineEdit(self)
        self.txt_load2.move(Vpoint[4],Hpoint[4])
        self.txt_load2.setFixedSize(100,25)
        self.txt_load2.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.txt_load2.textChanged.connect(self.update_sLoad)
        self.txt_load2.textEdited.connect(self.clear_load2)

        self.txt_finish3 = QtWidgets.QLineEdit(self)
        self.txt_finish3.move(Vpoint[1],Hpoint[5])
        self.txt_finish3.setFixedSize(100,25)
        self.txt_finish3.setAlignment(Qt.AlignmentFlag.AlignCenter)
        
        self.txt_density3 = QtWidgets.QLineEdit(self)
        self.txt_density3.move(Vpoint[2],Hpoint[5])
        self.txt_density3.setFixedSize(100,25)
        self.txt_density3.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.txt_density3.setValidator(self.validator)
        self.txt_density3.textChanged.connect(self.update_load3)
        
        self.txt_thk3 = QtWidgets.QLineEdit(self)
        self.txt_thk3.setFixedSize(100,25)
        self.txt_thk3.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.txt_thk3.move(Vpoint[3],Hpoint[5])
        self.txt_thk3.setValidator(self.validator)
        self.txt_thk3.textChanged.connect(self.update_load3)
        
        self.txt_load3 = QtWidgets.QLineEdit(self)
        self.txt_load3.move(Vpoint[4],Hpoint[5])
        self.txt_load3.setFixedSize(100,25)
        self.txt_load3.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.txt_load3.textChanged.connect(self.update_sLoad)
        self.txt_load3.textEdited.connect(self.clear_load3)
        
        self.txt_finish4 = QtWidgets.QLineEdit(self)
        self.txt_finish4.move(Vpoint[1],Hpoint[6])
        self.txt_finish4.setFixedSize(100,25)
        self.txt_finish4.setAlignment(Qt.AlignmentFlag.AlignCenter)
        
        self.txt_density4 = QtWidgets.QLineEdit(self)
        self.txt_density4.move(Vpoint[2],Hpoint[6])
        self.txt_density4.setFixedSize(100,25)
        self.txt_density4.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.txt_density4.setValidator(self.validator)
        self.txt_density4.textChanged.connect(self.update_load4)
        
        self.txt_thk4 = QtWidgets.QLineEdit(self)
        self.txt_thk4.setFixedSize(100,25)
        self.txt_thk4.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.txt_thk4.move(Vpoint[3],Hpoint[6])
        self.txt_thk4.setValidator(self.validator)
        self.txt_thk4.textChanged.connect(self.update_load4)
        
        self.txt_load4 = QtWidgets.QLineEdit(self)
        self.txt_load4.move(Vpoint[4],Hpoint[6])
        self.txt_load4.setFixedSize(100,25)
        self.txt_load4.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.txt_load4.textChanged.connect(self.update_sLoad)
        self.txt_load4.textEdited.connect(self.clear_load4)

        self.txt_finish5 = QtWidgets.QLineEdit(self)
        self.txt_finish5.move(Vpoint[1],Hpoint[7])
        self.txt_finish5.setFixedSize(100,25)
        self.txt_finish5.setAlignment(Qt.AlignmentFlag.AlignCenter)
        
        self.txt_density5 = QtWidgets.QLineEdit(self)
        self.txt_density5.move(Vpoint[2],Hpoint[7])
        self.txt_density5.setFixedSize(100,25)
        self.txt_density5.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.txt_density5.setValidator(self.validator)
        self.txt_density5.textChanged.connect(self.update_load5)
        
        self.txt_thk5 = QtWidgets.QLineEdit(self)
        self.txt_thk5.setFixedSize(100,25)
        self.txt_thk5.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.txt_thk5.move(Vpoint[3],Hpoint[7])
        self.txt_thk5.setValidator(self.validator)
        self.txt_thk5.textChanged.connect(self.update_load5)
        
        self.txt_load5 = QtWidgets.QLineEdit(self)
        self.txt_load5.move(Vpoint[4],Hpoint[7])
        self.txt_load5.setFixedSize(100,25)
        self.txt_load5.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.txt_load5.textChanged.connect(self.update_sLoad)
        self.txt_load5.textEdited.connect(self.clear_load5)

        self.txt_finish6 = QtWidgets.QLineEdit(self)
        self.txt_finish6.move(Vpoint[1],Hpoint[8])
        self.txt_finish6.setFixedSize(100,25)
        self.txt_finish6.setAlignment(Qt.AlignmentFlag.AlignCenter)
        
        self.txt_density6 = QtWidgets.QLineEdit(self)
        self.txt_density6.move(Vpoint[2],Hpoint[8])
        self.txt_density6.setFixedSize(100,25)
        self.txt_density6.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.txt_density6.setValidator(self.validator)
        self.txt_density6.textChanged.connect(self.update_load6)
        
        self.txt_thk6 = QtWidgets.QLineEdit(self)
        self.txt_thk6.setFixedSize(100,25)
        self.txt_thk6.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.txt_thk6.move(Vpoint[3],Hpoint[8])
        self.txt_thk6.setValidator(self.validator)
        self.txt_thk6.textChanged.connect(self.update_load6)
        
        self.txt_load6 = QtWidgets.QLineEdit(self)
        self.txt_load6.move(Vpoint[4],Hpoint[8])
        self.txt_load6.setFixedSize(100,25)
        self.txt_load6.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.txt_load6.textChanged.connect(self.update_sLoad)
        self.txt_load6.textEdited.connect(self.clear_load6)

        self.txt_sLoad = QtWidgets.QLineEdit(self)
        self.txt_sLoad.move(Vpoint[4],Hpoint[9])
        self.txt_sLoad.setFixedSize(100,25)
        self.txt_sLoad.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.txt_sLoad.setStyleSheet(style_sheet2)
        self.txt_sLoad.setReadOnly(True)
        self.txt_sLoad.textChanged.connect(self.update_Dload)
        self.txt_sLoad.setFocusPolicy(Qt.FocusPolicy.NoFocus)
    
        #여기부터는 슬래브 하중 입력

        self.txt_floorType = QtWidgets.QLineEdit(self)
        self.txt_floorType.move(Vpoint[0],Hpoint[10])
        self.txt_floorType.setText('슬래브')
        self.txt_floorType.setFixedSize(100,25)
        self.txt_floorType.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.txt_floorType.setStyleSheet(style_sheet1)
        self.txt_floorType.setReadOnly(True)
        self.txt_floorType.setFocusPolicy(Qt.FocusPolicy.NoFocus)

        self.cBox_FloorType = QtWidgets.QComboBox(self)
        self.floor_types = ['없음','콘크리트 슬래브', '데크 슬래브', '자중은 프로그램에서 자동계산', '계단 슬래브']
        self.cBox_FloorType.addItems(self.floor_types)
        self.cBox_FloorType.move(Vpoint[1],Hpoint[10])
        self.cBox_FloorType.setFixedSize(210,25)
        self.cBox_FloorType.currentIndexChanged.connect(self.on_floortype_changed)
        
        self.txt_thkConc = QtWidgets.QLineEdit(self)
        self.txt_thkConc.setFixedSize(100,25)
        self.txt_thkConc.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.txt_thkConc.move(Vpoint[3],Hpoint[10])
        self.txt_thkConc.setValidator(self.validator)
        self.txt_thkConc.textChanged.connect(self.update_Concload)

        self.txt_ConcLoad = QtWidgets.QLineEdit(self)
        self.txt_ConcLoad.move(Vpoint[4],Hpoint[10])
        self.txt_ConcLoad.setFixedSize(100,25)
        self.txt_ConcLoad.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.txt_ConcLoad.setStyleSheet(style_sheet2)
        self.txt_ConcLoad.setReadOnly(True)
        self.txt_ConcLoad.textChanged.connect(self.update_Dload)
        self.txt_ConcLoad.setFocusPolicy(Qt.FocusPolicy.NoFocus)

        self.txt_DLoad = QtWidgets.QLineEdit(self)
        self.txt_DLoad.move(Vpoint[4],Hpoint[11])
        self.txt_DLoad.setFixedSize(100,25)
        self.txt_DLoad.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.txt_DLoad.setStyleSheet(style_sheet2)
        self.txt_DLoad.setReadOnly(True)
        self.txt_DLoad.setFocusPolicy(Qt.FocusPolicy.NoFocus)
        
        # 활하중 입력하기
        # Load data from db
        KDSfile_path = 'form\KDS_Liveload.db'
        self.KDS_liveloaddata = load_csv_data(KDSfile_path)      
                
        txt_LiveRoom = QtWidgets.QLineEdit(self)
        txt_LiveRoom.move(Vpoint[0],Hpoint[12])
        txt_LiveRoom.setText('용도')
        txt_LiveRoom.setFixedSize(100,25)
        txt_LiveRoom.setAlignment(Qt.AlignmentFlag.AlignCenter)
        txt_LiveRoom.setStyleSheet(style_sheet1)
        txt_LiveRoom.setReadOnly(True)
        txt_LiveRoom.setFocusPolicy(Qt.FocusPolicy.NoFocus)

        self.livecategory_combo = QtWidgets.QComboBox(self)
        self.livecategory_combo.move(Vpoint[1],Hpoint[12])
        self.livecategory_combo.setFixedSize(100,25)

        self.subcategory_combo = QtWidgets.QComboBox(self)
        self.subcategory_combo.move(Vpoint[2],Hpoint[12])
        self.subcategory_combo.setFixedSize(210,25)

        self.txt_LiveLoad = QtWidgets.QLineEdit(self)
        self.txt_LiveLoad.setAlignment(Qt.AlignmentFlag.AlignCenter)
        self.txt_LiveLoad.move(Vpoint[4],Hpoint[12])
        self.txt_LiveLoad.setFixedSize(100,25)
        self.txt_LiveLoad.setValidator(self.validator)
        self.txt_LiveLoad.textChanged.connect(self.check_roofLive)

        self.chk_RoofLiveLoad = QtWidgets.QCheckBox(self)
        self.chk_RoofLiveLoad.setText('지붕 활하중으로 적용')
        self.chk_RoofLiveLoad.move(Vpoint[3]+70,Hpoint[13])
        self.chk_RoofLiveLoad.setFixedSize(210,25)
        self.chk_RoofLiveLoad.setVisible(False)
        
               
        # Populate category combo box
        self.livecategory_combo.addItems(self.KDS_liveloaddata.keys())
        category = self.livecategory_combo.currentText()
        subcategories = self.KDS_liveloaddata.get(category, {})
        self.subcategory_combo.addItems(subcategories.keys())
        self.on_subcategory_changed()

        # Set up signals
        self.livecategory_combo.currentIndexChanged.connect(self.on_category_changed)
        self.subcategory_combo.currentIndexChanged.connect(self.on_subcategory_changed)

        # 버튼 만드는 창
        btn_InsertLoad = QtWidgets.QPushButton(self)
        btn_InsertLoad.setText('등록')
        btn_InsertLoad.move(Vpoint[0],Hpoint[14])
        btn_InsertLoad.setFixedSize(100,25)
        btn_InsertLoad.clicked.connect(self.insert_db)

        btn_EditLoad = QtWidgets.QPushButton(self)
        btn_EditLoad.setText('수정')
        btn_EditLoad.move(Vpoint[1],Hpoint[14])
        btn_EditLoad.setFixedSize(100,25)
        btn_EditLoad.clicked.connect(self.edit_db)

        btn_DelLoad = QtWidgets.QPushButton(self)
        btn_DelLoad.setText('삭제')
        btn_DelLoad.move(Vpoint[2],Hpoint[14])
        btn_DelLoad.setFixedSize(100,25)
        btn_DelLoad.clicked.connect(self.del_db)

        btn_Stair = QtWidgets.QPushButton(self)
        btn_Stair.setText('계단하중입력')
        btn_Stair.setToolTip('계단참 하중 입력 후 등록 \n또는 계단참 하중을 선택한 후 클릭')
        btn_Stair.move(Vpoint[5],Hpoint[13])
        btn_Stair.setFixedSize(100,25)
        btn_Stair.clicked.connect(self.open_dialog_stair)

        btn_InitLoad = QtWidgets.QPushButton(self)
        btn_InitLoad.setText('입력창 초기화')
        btn_InitLoad.move(Vpoint[4],Hpoint[14])
        btn_InitLoad.setFixedSize(100,25)
        btn_InitLoad.clicked.connect(self.init_text)

        btn_makeLoadTable = QtWidgets.QPushButton(self)
        btn_makeLoadTable.setText('하중표만들기')
        btn_makeLoadTable.move(Vpoint[5],Hpoint[14])
        btn_makeLoadTable.setFixedSize(100,25)
        btn_makeLoadTable.clicked.connect(self.on_click_maketable)

        btn_ExportLoad = QtWidgets.QPushButton(self)
        btn_ExportLoad.setText('Export to')
        btn_ExportLoad.move(Vpoint[7],Hpoint[14])
        btn_ExportLoad.setFixedSize(100,25)
        btn_ExportLoad.clicked.connect(self.on_click_Export)

        self.cBox_ExportProgram = QtWidgets.QComboBox(self)
        self.ProgramType = [r'MIDAS/Gen',r'MIDAS/SDS',r'MIDAS/ADS',r'Design+']
        self.cBox_ExportProgram.addItems(self.ProgramType)
        self.cBox_ExportProgram.move(Vpoint[8],Hpoint[14])
        self.cBox_ExportProgram.setFixedSize(100,25)

        # btn_search = QPushButton(self)
        # btn_search.setText('검색')
        
        # btn_search.move(Vpoint[5],Hpoint[1])
        # btn_search.setFixedSize(100,25)
        # btn_search.clicked.connect(self.update_table(self.df_load))
        


        # 스크롤 버튼


        btn_5ArrayUp = QtWidgets.QPushButton(self)
        btn_5ArrayUp.setText('▲▲')
        btn_5ArrayUp.move(Vpoint[10]+40,Hpoint[0])
        btn_5ArrayUp.setFixedSize(40,25)
        btn_5ArrayUp.clicked.connect(self.change_uprow5)

        btn_ArrayUp = QtWidgets.QPushButton(self)
        btn_ArrayUp.setText('▲')
        btn_ArrayUp.move(Vpoint[10]+90,Hpoint[0])
        btn_ArrayUp.setFixedSize(40,25)
        btn_ArrayUp.clicked.connect(self.change_uprow)

        btn_ArrayDn = QtWidgets.QPushButton(self)
        btn_ArrayDn.setText('▼')
        btn_ArrayDn.move(Vpoint[11]+30,Hpoint[0])
        btn_ArrayDn.setFixedSize(40,25)
        btn_ArrayDn.clicked.connect(self.change_downrow)
        
        btn_5ArrayDn = QtWidgets.QPushButton(self)
        btn_5ArrayDn.setText('▼▼')
        btn_5ArrayDn.move(Vpoint[11]+80,Hpoint[0])
        btn_5ArrayDn.setFixedSize(40,25)
        btn_5ArrayDn.clicked.connect(self.change_downrow5)
        
    def closeEvent(self, event):
        reply = QtWidgets.QMessageBox.question(self, '확인', '저장하시겠습니까?', QtWidgets.QMessageBox.StandardButton.Save | QtWidgets.QMessageBox.StandardButton.Discard | QtWidgets.QMessageBox.StandardButton.Cancel)

        if reply == QtWidgets.QMessageBox.StandardButton.Save:
            MainWindow.on_click_FileSave()
            event.accept()
        elif reply == QtWidgets.QMessageBox.StandardButton.Discard:
            event.accept()
        else:
            event.ignore()


    def update_load1(self):
        try :
            density = self.txt_density1.text()
            thk = self.txt_thk1.text()

            if not density or not thk:  # 입력값이 비어 있는지 확인
                self.txt_load1.setText('')
                return
        
            if not self.validator.validate(density, 0)[0] or not self.validator.validate(thk, 0)[0]:
                QtWidgets.QMessageBox.critical(self, 'Error', 'Please enter a number')
                return
            density = float(density)
            thk = float(thk)
            self.txt_load1.setText(str(round(density * thk * 0.001,2)))
            self.update_sLoad()

        except ValueError:
            return

    def update_load2(self):
        density = self.txt_density2.text()
        thk = self.txt_thk2.text()

        if not density or not thk:  # 입력값이 비어 있는지 확인
            self.txt_load2.setText('')
            return
    
        if not self.validator.validate(density, 0)[0] or not self.validator.validate(thk, 0)[0]:
            QtWidgets.QMessageBox.critical(self, 'Error', 'Please enter a number')
            return
        density = float(density)
        thk = float(thk)
        self.txt_load2.setText(str(round(density * thk * 0.001,2)))
        self.update_sLoad()

    def update_load3(self):
        density = self.txt_density3.text()
        thk = self.txt_thk3.text()

        if not density or not thk:  # 입력값이 비어 있는지 확인
            self.txt_load3.setText('')
            return
    
        if not self.validator.validate(density, 0)[0] or not self.validator.validate(thk, 0)[0]:
            QtWidgets.QMessageBox.critical(self, 'Error', 'Please enter a number')
            return
        density = float(density)
        thk = float(thk)
        self.txt_load3.setText(str(round(density * thk * 0.001,2)))
        self.update_sLoad()

    def update_load4(self):
        density = self.txt_density4.text()
        thk = self.txt_thk4.text()

        if not density or not thk:  # 입력값이 비어 있는지 확인
            self.txt_load4.setText('')
            return
    
        if not self.validator.validate(density, 0)[0] or not self.validator.validate(thk, 0)[0]:
            QtWidgets.QMessageBox.critical(self, 'Error', 'Please enter a number')
            return
        density = float(density)
        thk = float(thk)
        self.txt_load4.setText(str(round(density * thk * 0.001,2)))
        self.update_sLoad()

    def update_load5(self):
        density = self.txt_density5.text()
        thk = self.txt_thk5.text()

        if not density or not thk:  # 입력값이 비어 있는지 확인
            self.txt_load5.setText('')
            return
    
        if not self.validator.validate(density, 0)[0] or not self.validator.validate(thk, 0)[0]:
            QtWidgets.QMessageBox.critical(self, 'Error', 'Please enter a number')
            return
        density = float(density)
        thk = float(thk)
        self.txt_load5.setText(str(round(density * thk * 0.001,2)))
        self.update_sLoad()

    def update_load6(self):
        density = self.txt_density6.text()
        thk = self.txt_thk6.text()

        if not density or not thk:  # 입력값이 비어 있는지 확인
            self.txt_load6.setText('')
            return
    
        if not self.validator.validate(density, 0)[0] or not self.validator.validate(thk, 0)[0]:
            QtWidgets.QMessageBox.critical(self, 'Error', 'Please enter a number')
            return
        density = float(density)
        thk = float(thk)
        self.txt_load6.setText(str(round(density * thk * 0.001,2)))
        self.update_sLoad()

    def update_sLoad(self):
        Load1 = self.txt_load1.text()
        Load2 = self.txt_load2.text()
        Load3 = self.txt_load3.text()
        Load4 = self.txt_load4.text()
        Load5 = self.txt_load5.text()
        Load6 = self.txt_load6.text()

        if not Load1: Load1=str(0)
        if not Load2: Load2=str(0)
        if not Load3: Load3=str(0)
        if not Load4: Load4=str(0)
        if not Load5: Load5=str(0)
        if not Load6: Load6=str(0)
    
        if not self.validator.validate(Load1, 0)[0] or not self.validator.validate(Load2, 0)[0] or not self.validator.validate(Load3, 0)[0] or not self.validator.validate(Load4, 0)[0] or not self.validator.validate(Load5, 0)[0] or not self.validator.validate(Load6, 0)[0]:
            QtWidgets.QMessageBox.critical(self, 'Error', 'Please enter a number')
            return
        Load1 = float(Load1)
        Load2 = float(Load2)
        Load3 = float(Load3)
        Load4 = float(Load4)
        Load5 = float(Load5)
        Load6 = float(Load6)

        self.txt_sLoad.setText(str(round(Load1+Load2+Load3+Load4+Load5+Load6,2)))       
      
    def clear_load1(self):
        # self.txt_finish1.setText("")
        self.txt_density1.setText("")
        self.txt_thk1.setText("")

    def clear_load2(self):
        # self.txt_finish2.setText("")
        self.txt_density2.setText("")
        self.txt_thk2.setText("")

    def clear_load3(self):
        # self.txt_finish3.setText("")
        self.txt_density3.setText("")
        self.txt_thk3.setText("")

    def clear_load4(self):
        # self.txt_finish4.setText("")
        self.txt_density4.setText("")
        self.txt_thk4.setText("")

    def clear_load5(self):
        # self.txt_finish5.setText("")
        self.txt_density5.setText("")
        self.txt_thk5.setText("")

    def clear_load6(self):
        # self.txt_finish6.setText("")
        self.txt_density6.setText("")
        self.txt_thk6.setText("")

    #슬래브 하중 계산 관련 함수
    def on_floortype_changed(self, index):
        thk = self.txt_thkConc.text()
        density = 24

        if index == 0 or index == 3: 
            self.txt_thkConc.setText("") 
            self.txt_ConcLoad.setText("") 
            return

        if not thk:  # 입력값이 비어 있는지 확인
            return

        if not self.validator.validate(thk, 0)[0]:
            QtWidgets.QMessageBox.critical(self, 'Error', 'Please enter a number')
            return

        thk = float(thk)
        load = density * thk * 0.001

        if index == 2:
            load += 0.2

        self.txt_ConcLoad.setText(str(round(load, 2)))

    def update_Concload(self):
        index = self.cBox_FloorType.currentIndex()
        self.on_floortype_changed(index)

    # 고정하중의 합 산정   

    def update_Dload(self):
        sLoad = self.txt_sLoad.text()
        ConcLoad = self.txt_ConcLoad.text()

        if not sLoad : sLoad = 0
        if not ConcLoad : ConcLoad = 0
            
        sLoad = float(sLoad)
        ConcLoad = float(ConcLoad)

        DLoad = sLoad + ConcLoad
        self.txt_DLoad.setText(str(round(DLoad, 2)))


    # 활하중 콤보박스 변경 시 동작하는 함수
    def on_category_changed(self):
        category = self.livecategory_combo.currentText()
        subcategories = self.KDS_liveloaddata.get(category, {})
        self.subcategory_combo.clear()
        self.subcategory_combo.addItems(subcategories.keys())
        self.on_subcategory_changed()

    def on_subcategory_changed(self):
        subcategory = self.subcategory_combo.currentText()
        category = self.livecategory_combo.currentText()
        value = self.KDS_liveloaddata.get(category, {}).get(subcategory, "")
        self.txt_LiveLoad.setText(str(value))

    # 하중 입력 및 RoofLive Check 작업
    def check_roofLive(self):
        text = self.txt_LiveLoad.text() 
        try : 
            float(text)
        except ValueError:
            if text :
                QtWidgets.QMessageBox.warning(None, '경고','하중값을 직접 입력하세요.')
                self.txt_LiveLoad.setFocus()
                self.txt_LiveLoad.selectAll()
                
        if self.subcategory_combo.currentText() == "점유⋅사용하지 않는 지붕(지붕활하중)" :
            self.chk_RoofLiveLoad.setCheckState(Qt.CheckState.Checked)
        else :
            self.chk_RoofLiveLoad.setCheckState(Qt.CheckState.Unchecked)


    # # 새파일 버튼 클릭
    # def on_click_New(self):
                        
    #     if not self.df_load.empty or not self.txt_FileName.text() == "":
    #         reply = QtWidgets.QMessageBox.question(self, '경고', '정말로 새로 만드시겠습니까? 작업된 내용은 삭제됩니다.', QtWidgets.QMessageBox.StandardButton.Ok | QtWidgets.QMessageBox.StandardButton.Cancel)

    #         if reply == QtWidgets.QMessageBox.StandardButton.Cancel: return
            
    #     self.txt_FileName.clear()
    #     self.df_load = pd.DataFrame(columns = ['ID','floor','name','f1','d1','t1','l1','f2','d2','t2','l2','f3','d3','t3','l3','f4','d4','t4','l4','f5','d5','t5','l5','f6','d6','t6','l6','SDL','Type','conthk','conLoad','DL','Category','subcategory','LR','LL','Service','Strength'])
    #     self.update_table(self.df_load)



    # # 파일 오픈 버튼 클릭
    # def on_click_FileOpen(self):
                
    #     file_name, _ = QtWidgets.QFileDialog.getOpenFileName(self, "파일 선택", "", "DYL Files (*.dyl);;All Files (*)")
    #     if file_name:
    #         self.df_load = pd.read_csv(file_name, index_col='ID', encoding='utf-8')
    #         self.df_load.reset_index(inplace=True)
    #         self.txt_FileName.setText(file_name)  
    #         self.update_table(self.df_load)

    # # 파일 저장 버튼 클릭
    # def on_click_FileSave(self):

    #     if self.txt_FileName.text() == "":
    #         on_click_FileSaveAs()
    #         return
       
    #     try : 
    #         file_name = self.txt_FileName.text()
    #         self.df_load.to_csv(file_name, index=False, encoding='utf-8')
    #         self.txt_FileName.setText(file_name)
    #         QtWidgets.QMessageBox.information(None, '확인', '저장하였습니다.')
    #     except PermissionError:
    #         msg = QtWidgets.QMessageBox()
    #         msg.setText("저장오류")
    #         msg.setInformativeText(f"Failed to save file {file_name}.\n열려있는 파일을 닫아주세요.")
    #         msg.setFixedSize(800,100)
    #         msg.setWindowTitle("Error")
    #         msg.exec() 
        
    # # 새이름 저장 버튼 클릭
    # def on_click_FileSaveAs(self):
         
    #     file_name, _ = QtWidgets.QFileDialog.getSaveFileName(self, "파일 선택", "", "DYL Files (*.dyl);;All Files (*)")
    #     self.txt_FileName.setText(file_name)
    #     if file_name:
    #         try : 
    #             self.df_load.to_csv(file_name, index=False, encoding='utf-8')
    #             self.txt_FileName.setText(file_name)
    #             QtWidgets.QMessageBox.information(None, '확인', '저장하였습니다.')
    #         except PermissionError:
    #             msg = QtWidgets.QMessageBox()
    #             msg.setText("저장오류")
    #             msg.setInformativeText(f"Failed to save file {file_name}.\n열려있는 파일을 닫아주세요.")
    #             msg.setFixedSize(800,100)
    #             msg.setWindowTitle("Error")
    #             msg.exec() 
    
    def on_click_maketable(self):
        ''' 하중표 만들기 버튼 클릭'''
        self.project = self.information.information['project']
        maketable.make_loadtable(self.df_load,self.project)

    # Export 버튼 클릭
    def on_click_Export(self):

      #  self.main_window.on_click_FileSave(self)

        if self.cBox_ExportProgram.currentIndex() == 0 :
            file_name, ok = QtWidgets.QInputDialog.getText(None, "파일입력","파일 이름을 입력하세요(일부만 입력해도 됩니다.)\n하중입력 완료 메세지가 나올 때까지 가급적 다른 작업을 하지 마세요. : ")
            res = InputLoad.ExportGen(file_name,self.df_load)
            if res == 0:
                QtWidgets.QMessageBox.information(None, '확인', '하중입력이 완료되었습니다. 확인해 보세요.')
            elif res == 1:
                QtWidgets.QMessageBox.information(None, '확인', '파일을 찾지 못하였습니다. \nGen이 열려 있는지 확인하고 파일명을 다시 입력해 보세요')
            elif res == 2:
                QtWidgets.QMessageBox.information(None, '확인', '권한이 없습니다.\n 관리자 모드로 DYL을 실행하세요.')
        else:
            QtWidgets.QMessageBox.information(None, '확인', '준비 중 입니다.')

    def update_table(self, db):
        db = db.fillna("")
        self.tbl_Load.setRowCount(len(db))
        col_nums = [0,1,2,33,29,31,35,36,37]
        
        for i, col_num in enumerate(col_nums):
            col = db.iloc[ :, col_num]
            for j, value in enumerate(col):
                item = QtWidgets.QTableWidgetItem(str(value))
                self.tbl_Load.setItem(j, i, item)
                self.tbl_Load.item(j,i).setTextAlignment(Qt.AlignmentFlag.AlignCenter)

    def handle_cell_click(self, row, column):
        self.selected_index = self.tbl_Load.item(row, 0).text()
        
        self.selected_index = int(self.selected_index)
        self.infill_text(self.selected_index)

    def infill_text(self,index):
        series_db = self.df_load.iloc[index, :]
        series_db = series_db.fillna("")
        self.txt_id.setText(str(series_db[0])) #id
        self.txt_floor.setText(str(series_db[1])) #층수
        self.txt_name.setText(str(series_db[2]))    #실명
        self.txt_finish1.setText(str(series_db[3])) #재료마감
        self.txt_density1.setText(str(series_db[4]))    #밀도
        self.txt_thk1.setText(str(series_db[5]))    #두께
        self.txt_load1.setText(str(series_db[6]))   #하중
        self.txt_finish2.setText(str(series_db[7])) #재료마감
        self.txt_density2.setText(str(series_db[8]))    #밀도
        self.txt_thk2.setText(str(series_db[9]))    #두께
        self.txt_load2.setText(str(series_db[10]))  #하중
        self.txt_finish3.setText(str(series_db[11]))    #재료마감
        self.txt_density3.setText(str(series_db[12]))   #밀도
        self.txt_thk3.setText(str(series_db[13]))       #두께
        self.txt_load3.setText(str(series_db[14]))      #하중
        self.txt_finish4.setText(str(series_db[15]))    #마감
        self.txt_density4.setText(str(series_db[16]))   #밀도
        self.txt_thk4.setText(str(series_db[17]))       #두께
        self.txt_load4.setText(str(series_db[18]))      #하중
        self.txt_finish5.setText(str(series_db[19]))    #마감
        self.txt_density5.setText(str(series_db[20]))   #밀도   
        self.txt_thk5.setText(str(series_db[21]))       #두께
        self.txt_load5.setText(str(series_db[22]))      #하중
        self.txt_finish6.setText(str(series_db[23]))    #마감
        self.txt_density6.setText(str(series_db[24]))   #밀도
        self.txt_thk6.setText(str(series_db[25]))       #두께
        self.txt_load6.setText(str(series_db[26]))      #하중
                                                        #27: SDL
        self.cBox_FloorType.setCurrentText(str(series_db[28])) #28:Type
        self.txt_thkConc.setText(str(series_db[29]))        #29 : 두께
                                                        #30 : 슬래브 하중
                                                        #31 : DL
        self.livecategory_combo.setCurrentText(str(series_db[32])) #32 : 용도대분류
        self.subcategory_combo.setCurrentText(str(series_db[33]))   #33 : 용도소분류
                                                        #34: 지붕활하중
        self.txt_LiveLoad.setText(str(series_db[35]))   #35: LL
                                                        #36: D+L
                                                        #37: 1.2D+1.6L         

        if series_db[34] == "CHECK":
            self.chk_RoofLiveLoad.setCheckState(Qt.CheckState.Checked)
        elif series_db[34] == "": 
            self.chk_RoofLiveLoad.setCheckState(Qt.CheckState.Unchecked)

    # 초기화 버튼 클릭시 작동
    def init_text(self):
        self.txt_floor.clear()
        self.txt_name.clear()
        self.txt_finish1.clear()
        self.txt_density1.clear()
        self.txt_thk1.clear()
        self.txt_load1.clear()
        self.txt_finish2.clear()
        self.txt_density2.clear()
        self.txt_thk2.clear()
        self.txt_load2.clear()
        self.txt_finish3.clear()
        self.txt_density3.clear()
        self.txt_thk3.clear()
        self.txt_load3.clear()
        self.txt_finish4.clear()
        self.txt_density4.clear()
        self.txt_thk4.clear()
        self.txt_load4.clear()
        self.txt_finish5.clear()
        self.txt_density5.clear()
        self.txt_thk5.clear()
        self.txt_load5.clear()
        self.txt_finish6.clear()
        self.txt_density6.clear()
        self.txt_thk6.clear()
        self.txt_load6.clear()

        self.cBox_FloorType.setCurrentIndex(0)
        self.txt_thkConc.clear()
        self.txt_DLoad.clear()

        self.livecategory_combo.setCurrentIndex(0)
        self.subcategory_combo.setCurrentIndex(0)
        self.txt_LiveLoad.clear()
      
        self.chk_RoofLiveLoad.setCheckState(Qt.CheckState.Unchecked)


    # 등록버튼 클릭시 작동
    def insert_db(self):
        index = self.df_load['ID'].max() + 1

        if self.txt_floor.text() == "":
            QtWidgets.QMessageBox.information(None, '경고', '층수를 입력하세요')
            return
        if self.txt_name.text() == "":
            QtWidgets.QMessageBox.information(None, '경고', '실명를 입력하세요')
            return
        if self.txt_LiveLoad.text() == "":
            QtWidgets.QMessageBox.information(None, '경고', '활하중을 입력하세요')
            return
        
        mask = self.df_load['floor'] == self.txt_floor.text()
        result = self.df_load.loc[mask, 'name'] == self.txt_name.text()
        if result.any():
            QtWidgets.QMessageBox.information(None, '경고', '동일한 층수에 동일한 실명이 존재합니다.')
            return

        db = self.update_db(index)

        self.df_load.loc[len(self.df_load)] = db
        self.df_load['ID'] = range(len(self.df_load))
        self.df_load = self.df_load.reset_index(drop=True)
        self.update_table(self.df_load)

    # 수정버튼 클릭시 작동
    def edit_db(self):
        if not self.txt_id.text() :
            msg = QtWidgets.QMessageBox()
            msg.setText("Error")
            msg.setInformativeText("수정할 하중을 선택하세요")
            msg.setWindowTitle("Error")
            msg.exec()   
            return
        index = int(self.txt_id.text())
        db = self.update_db(index)

        self.df_load.loc[self.df_load['ID']==index] = db
        self.df_load['ID'] = range(len(self.df_load))
        self.update_table(self.df_load)

        self.txt_id.setText(str(index))
        self.tbl_Load.setCurrentCell(index,0)

    # 삭제버튼 클릭시 작동
    def del_db(self):
        index = int(self.txt_id.text())

        self.df_load = self.df_load.loc[self.df_load['ID'] !=index ] 
        self.df_load['ID'] = range(len(self.df_load))
        self.update_table(self.df_load)

    def update_db(self, index):
        if self.chk_RoofLiveLoad.setCheckState(Qt.CheckState.Checked) :
            temp_Rll = "CHECK"
        else:
            temp_Rll = ""
        if self.txt_DLoad.text() == "" : self.txt_DLoad.setText(0)
        ServiceLoad = round(float(self.txt_DLoad.text()) + float(self.txt_LiveLoad.text()),2)
        StrengthLoad = round(1.2*float(self.txt_DLoad.text()) + 1.6*float(self.txt_LiveLoad.text()),2)
        db = [index, self.txt_floor.text(), self.txt_name.text(), 
              self.txt_finish1.text(), self.txt_density1.text(), self.txt_thk1.text(), self.txt_load1.text(), 
              self.txt_finish2.text(), self.txt_density2.text(), self.txt_thk2.text(), self.txt_load2.text(),
              self.txt_finish3.text(), self.txt_density3.text(), self.txt_thk3.text(), self.txt_load3.text(),
              self.txt_finish4.text(), self.txt_density4.text(), self.txt_thk4.text(), self.txt_load4.text(),
              self.txt_finish5.text(), self.txt_density5.text(), self.txt_thk5.text(), self.txt_load5.text(),
              self.txt_finish6.text(), self.txt_density6.text(), self.txt_thk6.text(), self.txt_load6.text(),
              self.txt_sLoad.text(),
              self.cBox_FloorType.currentText(), self.txt_thkConc.text(), self.txt_ConcLoad.text(),
              self.txt_DLoad.text(),
              self.livecategory_combo.currentText(), self.subcategory_combo.currentText(), temp_Rll, self.txt_LiveLoad.text(),
              ServiceLoad, StrengthLoad
        ]

        return db
    
    #행순서 교체
    def change_uprow(self):
        
        try:
            index = int(self.txt_id.text())
            temp = self.df_load.loc[self.df_load.index==index].copy()
            self.df_load.loc[self.df_load.index==index] = self.df_load.loc[self.df_load.index==index-1].values
            self.df_load.loc[self.df_load.index==index-1] = temp.values
            self.df_load['ID'] = range(len(self.df_load))
            self.update_table(self.df_load)
            self.tbl_Load.setCurrentCell(index-1,0)
            self.txt_id.setText(str(index-1))
        except ValueError:
            pass

    def change_uprow5(self):
        
        try:
            index = int(self.txt_id.text())
            temp = self.df_load.loc[self.df_load.index==index].copy()
            self.df_load.loc[self.df_load.index==index] = self.df_load.loc[self.df_load.index==index-5].values
            self.df_load.loc[self.df_load.index==index-5] = temp.values
            self.df_load['ID'] = range(len(self.df_load))
            self.update_table(self.df_load)
            self.tbl_Load.setCurrentCell(index-5,0)
            self.txt_id.setText(str(index-5))
        except ValueError:
            pass


    def change_downrow(self):
        
        try:
            index = int(self.txt_id.text())
            temp = self.df_load.loc[self.df_load.index==index].copy()
            self.df_load.loc[self.df_load.index==index] = self.df_load.loc[self.df_load.index==index+1].values
            self.df_load.loc[self.df_load.index==index+1] = temp.values
            self.df_load['ID'] = range(len(self.df_load))
            self.update_table(self.df_load)
            self.tbl_Load.setCurrentCell(index+1,0)
            self.txt_id.setText(str(index+1))
        except ValueError:
            pass

    def change_downrow5(self):
        
        try:
            index = int(self.txt_id.text())
            temp = self.df_load.loc[self.df_load.index==index].copy()
            self.df_load.loc[self.df_load.index==index] = self.df_load.loc[self.df_load.index==index+5].values
            self.df_load.loc[self.df_load.index==index+5] = temp.values
            self.df_load['ID'] = range(len(self.df_load))
            self.update_table(self.df_load)
            self.tbl_Load.setCurrentCell(index+5,0)
            self.txt_id.setText(str(index+5))
        except ValueError:
            pass

    # 계단하중 계산 창
    def cal_stair(self):
        try :
            if self.txt_thk1.text() == "": 
                thk1 = 0
            else : 
                thk1 = float(self.txt_thk1.text())

            if self.txt_thk2.text() == "": 
                thk2 = 0
            else : 
                thk2 = float(self.txt_thk2.text())
            if self.txt_thkConc.text() == "": 
                return
            else:  
                cthk = float(self.txt_thkConc.text())
            if self.line_edit_H.text()=="":
                return
            else: 
                H = float(self.line_edit_H.text())
            if self.line_edit_B.text()=="":
                return
            else: 
                B = float(self.line_edit_B.text())
            
            self.ethk1 = thk1 + ((H + thk2)/B) * thk1
            self.ethk2 = thk2 + (H/B) * thk2
            slope = (B**2 + H**2) **(1/2)
            self.ecthk = (cthk + (B*H)/(2*slope))*(slope/B)

            if thk1 == 0 :
                table_items = [
                    ['슬래브', self.txt_thkConc.text(),str(round(self.ecthk,2))]
                ]
            elif thk2 == 0 :
                table_items = [
                    [self.txt_finish1.text(), self.txt_thk1.text(),str(round(self.ethk1,2))],
                    ['슬래브', self.txt_thkConc.text(),str(round(self.ecthk,2))],
                ]
            else:
                table_items = [
                    [self.txt_finish1.text(), self.txt_thk1.text(),str(round(self.ethk1,2))],
                    [self.txt_finish2.text(), self.txt_thk2.text(),str(round(self.ethk2,2))],
                    ['슬래브', self.txt_thkConc.text(),str(round(self.ecthk,2))]
                ]

            for i, row_items in enumerate(table_items):
                for j, item in enumerate(row_items):
                    table_item = QtWidgets.QTableWidgetItem(item)
                    table_item.setTextAlignment(Qt.AlignmentFlag.AlignCenter)
                    self.tbl_stairload.setItem(i, j, table_item)

        except ValueError:
            return

    def on_add_clicked(self):   
        # 등록버튼 클릭시 작동
        index = int(self.df_load['ID'].max()) + 1

        if self.txt_ConcLoad.text() == "":
            QtWidgets.QMessageBox.information(None, '경고', '계단참 하중이 제대로 입력되지 않았습니다.')
            self.dialog.reject()
            return

        if self.line_stairfloor.text() == "":
            QtWidgets.QMessageBox.information(None, '경고', '층수를 입력하세요')
            return
        if self.line_stairname.text() == "":
            QtWidgets.QMessageBox.information(None, '경고', '실명를 입력하세요')
            return
        if self.txt_LiveLoad.text() == "":
            QtWidgets.QMessageBox.information(None, '경고', '활하중이 입력되지 않았습니다. 다시 입력하세요')
            self.dialog.reject()
            return
        
        mask = self.df_load['floor'] == self.line_stairfloor.text()
        result = self.df_load.loc[mask, 'name'] == self.line_stairname.text()
        if result.any():
            QtWidgets.QMessageBox.information(None, '경고', '동일한 층수에 동일한 실명이 존재합니다.')
            return

        db = self.update_db_stair(index)

        self.df_load.loc[len(self.df_load)] = db
        self.df_load['ID'] = range(len(self.df_load))
        self.df_load = self.df_load.reset_index(drop=True)
        self.update_table(self.df_load)

        self.dialog.accept()

    def update_db_stair(self, index):
        t_ecthk = round(float(self.ecthk),0)
        conLoad = round(float(self.ecthk) * 24 * 0.001,2)

        if self.ethk1 == 0 : 
            Load1 = ""
            finish1 = ""
            finish2 = ""
            Load2 = ""
            sLoad = ""
            Dload = round(conLoad,2)
            t_ethk1 =""
            t_ethk2 = ""
            t_density1 = ""
            t_density2 = ""

        elif self.ethk2 ==0 :
            Load1 = round(float(self.txt_density1.text()) * float(self.ethk1)*0.001,2)
            finish1 = self.txt_finish1.text()
            finish2 = ""
            Load2 = ""
            sLoad = Load1
            Dload = round(conLoad + Load1,2)
            t_ethk1 = round(self.ethk1,2)
            t_ethk2 = ""
            t_density1 = self.txt_density1.text()
            t_density2 = ""

        else:
            Load1 = round(float(self.txt_density1.text()) * float(self.ethk1)*0.001,2)
            finish1 = self.txt_finish1.text()
            finish2 = self.txt_finish2.text()
            Load2 = round(float(self.txt_density2.text()) * float(self.ethk2)*0.001,2)
            sLoad = Load1 + Load2
            Dload = round(conLoad + Load1 + Load2,2)
            t_ethk1 = round(self.ethk1,2)
            t_ethk2 = round(self.ethk2,2)
            t_density1 = self.txt_density1.text()
            t_density2 = self.txt_density2.text()

        ServiceLoad = round(Dload + float(self.txt_LiveLoad.text()),2)
        StrengthLoad = round(1.2*Dload + 1.6*float(self.txt_LiveLoad.text()),2)
        db = [index, self.line_stairfloor.text(), self.line_stairname.text(), 
              finish1, t_density1, t_ethk1, Load1, 
              finish2, t_density2, t_ethk2, Load2,
              "", "", "", "",
              "", "", "", "",
              "", "", "", "",
              "", "", "", "",
              sLoad,
              "계단 슬래브", t_ecthk, conLoad,
              Dload,
              self.livecategory_combo.currentText(), self.subcategory_combo.currentText(), "", self.txt_LiveLoad.text(),
              ServiceLoad, StrengthLoad
        ]

        return db

    def open_dialog_stair(self):

        H, B = (163, 260)
        self.dialog = QtWidgets.QDialog(self)
        self.dialog.setWindowTitle("계단하중 입력")
        self.dialog.resize(500,400)

        layout = QtWidgets.QVBoxLayout(self.dialog)

        layout_contents = QtWidgets.QHBoxLayout()
        layout_button = QtWidgets.QHBoxLayout()

        layout_input = QtWidgets.QVBoxLayout()
        layout_label = QtWidgets.QVBoxLayout()
       

        label_stair = QtWidgets.QLabel("")
        label_stair.setPixmap(QtGui.QPixmap(":/picture/Icons/Picture/stair.png").scaled(250,180))
        label_stair.setStyleSheet("border: 1px solid black;")

        layout_f = QtWidgets.QHBoxLayout()
        layout_g = QtWidgets.QHBoxLayout()

        label_B = QtWidgets.QLabel("L")
        label_B.setFixedWidth(30)
        self.line_edit_B = QtWidgets.QLineEdit()
        self.line_edit_B.setFixedWidth(100)
        self.line_edit_B.setText(str(B))
        self.line_edit_B.setValidator(QtGui.QDoubleValidator())
        label_H = QtWidgets.QLabel("H")
        label_H.setFixedWidth(30)
        self.line_edit_H = QtWidgets.QLineEdit()
        self.line_edit_H.setFixedWidth(100)
        self.line_edit_H.setText(str(H))
        self.line_edit_H.setValidator(QtGui.QDoubleValidator())

        label_stairfloor = QtWidgets.QLabel("층수")
        label_stairfloor.setFixedWidth(30)
        self.line_stairfloor = QtWidgets.QLineEdit()
        self.line_stairfloor.setFixedWidth(100)
        self.line_stairfloor.setText("공통")
        label_stairname = QtWidgets.QLabel("실명")
        label_stairname.setFixedWidth(30)
        self.line_stairname = QtWidgets.QLineEdit()
        self.line_stairname.setFixedWidth(100)
        self.line_stairname.setText("계단")
        
        layout_f.addWidget(label_B)
        layout_f.addWidget(self.line_edit_B)

        layout_f.addWidget(label_H)
        layout_f.addWidget(self.line_edit_H)

        layout_g.addWidget(label_stairfloor)
        layout_g.addWidget(self.line_stairfloor)

        layout_g.addWidget(label_stairname)
        layout_g.addWidget(self.line_stairname)

        btn_add = QtWidgets.QPushButton('등록')
        btn_add.setFixedSize(110,20)
        btn_add.clicked.connect(self.on_add_clicked)

        btn_cancel = QtWidgets.QPushButton('취소')
        btn_cancel.setFixedSize(110,20)
        btn_cancel.clicked.connect(self.dialog.reject)

 
        layout_input.addWidget(label_stair)
 
        self.tbl_stairload = QtWidgets.QTableWidget(self)
        self.tbl_stairload.setRowCount(3)
        self.tbl_stairload.setColumnCount(3)
        self.tbl_stairload.setFixedSize(320,150)

        stairlist_values = ['마감 및 슬래브', '두께', '환산두께']

        self.tbl_stairload.setHorizontalHeaderLabels(stairlist_values)
        self.tbl_stairload.setEditTriggers(QAbstractItemView.EditTrigger.NoEditTriggers)
        self.tbl_stairload.setColumnWidth(0, 100)
        self.tbl_stairload.setColumnWidth(1, 100)
        self.tbl_stairload.setColumnWidth(2, 100)
        self.tbl_stairload.verticalHeader().setVisible(False) 

        self.cal_stair()

        self.line_edit_B.textChanged.connect(self.cal_stair)
        self.line_edit_H.textChanged.connect(self.cal_stair)
 
                
        spacerItem = QtWidgets.QSpacerItem(20, 20, QtWidgets.QSizePolicy.Policy.Minimum, QtWidgets.QSizePolicy.Policy.Expanding)
        spacerItem2 = QtWidgets.QSpacerItem(20, 20, QtWidgets.QSizePolicy.Policy.Expanding, QtWidgets.QSizePolicy.Policy.Minimum)

        
       
        layout_label.addLayout(layout_g)
        layout_label.addWidget(self.tbl_stairload)  
        layout_label.addSpacerItem(spacerItem) 
        layout_label.addLayout(layout_f)     
          

        layout_contents.addLayout(layout_input)
        layout_contents.addLayout(layout_label)

        layout_button.addSpacerItem(spacerItem2)
        layout_button.addWidget(btn_add)
        layout_button.addWidget(btn_cancel)
        

        layout.addLayout(layout_contents)
        layout.addLayout(layout_button)

        self.dialog.exec()

class Page_WL(QtWidgets.QWidget):
    def __init__(self, main_window, information, parent=None):
        self.main_window = main_window
        self.information = information
        super().__init__(parent)

        #1단계 Layout
        layout_main = QtWidgets.QHBoxLayout(self)

        #2e단계 Layout 
        layout_Input = QtWidgets.QVBoxLayout(self)

        self.validator = QtGui.QDoubleValidator()

        # LineEdit를 Label과 같이 만들기 위한 스타일시트
        style_sheet1 = "QLineEdit {background-color: #7d7d7d; color: #ffffff; border: none;} "
        style_sheet2 = "QLineEdit {background-color: #cfcfcf; border: 1px solid #777777;} "
        self.setStyleSheet("QPushButton {border-color:#cfcfcf; border-style:solid; border-width: 1px;}\n"
                           "QPushButton:hover {background-color:#007e8e; color:white ;}\n"
                           "QLineEdit {background-color: #efefef; border: 1px solid #777777;}")

        # 입력창 1. Midas 자동입력여부 확인
        self.label_Midas = QtWidgets.QLabel("MiDAS 직접 입력", self)
        self.btn_yes_Midas = QtWidgets.QRadioButton("네", self)
        self.btn_yes_Midas.setChecked(True)
        self.btn_no_Midas = QtWidgets.QRadioButton("아니오", self)

        layout_Midas = QtWidgets.QHBoxLayout()
        layout_Midas.addWidget(self.label_Midas)
        layout_Midas.addWidget(self.btn_yes_Midas)
        layout_Midas.addWidget(self.btn_no_Midas)

        # 입력창 2. 지표면 조도 구분
        self.label_Categories = QtWidgets.QLabel("지표면 조도구분", self)
        self.combobox_Categories = QtWidgets.QComboBox(self)
        self.Item_Categories = ['A', 'B', 'C', 'D']
        self.combobox_Categories.addItems(self.Item_Categories)
        self.combobox_Categories.setCurrentIndex(2)

        layout_Categories = QtWidgets.QHBoxLayout()
        layout_Categories.addWidget(self.label_Categories)
        layout_Categories.addWidget(self.combobox_Categories)

        # 입력창 3. 건물 길이 입력
        self.label_Len_building = QtWidgets.QLabel('건물길이', self)
        self.label_Len_x = QtWidgets.QLabel('Lx', self)
        self.txt_Len_x = QtWidgets.QLineEdit()
        self.txt_Len_x.setStyleSheet(style_sheet2)
        self.label_Len_y = QtWidgets.QLabel('Ly', self)
        self.txt_Len_y = QtWidgets.QLineEdit()
        self.label_Af = QtWidgets.QLabel('Af', self)
        self.txt_Af = QtWidgets.QLineEdit()
        self.txt_Af.setToolTip('기준층 면적 입력, 빈칸으로 할 경우 직사각형으로 자동 계산됨.')

        layout_Len_building = QtWidgets.QHBoxLayout()
        layout_Len_building.addWidget(self.label_Len_building)
        layout_Len_building.addWidget(self.label_Len_x)
        layout_Len_building.addWidget(self.txt_Len_x)
        layout_Len_building.addWidget(self.label_Len_y)
        layout_Len_building.addWidget(self.txt_Len_y)
        layout_Len_building.addWidget(self.label_Af)
        layout_Len_building.addWidget(self.txt_Af)


        

        # Layout_Input 정렬
        layout_Input.addLayout(layout_Midas)
        layout_Input.addLayout(layout_Categories)
        layout_Input.addLayout(layout_Len_building)
        #layout_Input.addLayout(layout_address)

        # 지도Frame 생성

        layout_markermap = QtWidgets.QVBoxLayout(self)

        # 지도창
        self.map = QtWebEngineWidgets.QWebEngineView()
        self.map.setContentsMargins(10, 10, 10, 10)
        self.map.setFixedHeight(680)

        self.m = folium.Map(location=[36.111470, 128.397285], zoom_start=7, tiles='cartodbpositron')
        
        rfile = open('form\skorea_municipalities_geo_simple.json', 'r', encoding = 'utf-8').read()
        jsonData = json.loads(rfile)
        folium.GeoJson(jsonData, name='json_data', style_function=self.default_style_function).add_to(self.m)
 
        data = io.BytesIO()
        self.m.save(data, close_file=False)
        self.map.setHtml(data.getvalue().decode())

        # 주소창
        layout_address = QtWidgets.QHBoxLayout(self)

        self.label_address = QtWidgets.QLabel('주소', self)
        self.txt_address = QtWidgets.QLineEdit()
        self.txt_address.setReadOnly(True)
        self.txt_address.setStyleSheet(style_sheet2)
        self.btn_address = QtWidgets.QPushButton('지도 표시')
        self.btn_address.setStyleSheet(style_sheet1)
        self.btn_address.clicked.connect(lambda : self.change_circle())
        
        layout_address.addWidget(self.label_address)
        layout_address.addWidget(self.txt_address)
        layout_address.addWidget(self.btn_address)

        # 위도 경도 표시
        layout_latlng = QtWidgets.QHBoxLayout()

        self.label_lat = QtWidgets.QLabel('위도', self)
        self.label_lat.setFixedHeight(30)
        self.txt_lat = QtWidgets.QLineEdit(self)
        self.txt_lat.setReadOnly(True)
        self.txt_lat.setStyleSheet(style_sheet2)
        self.label_lng = QtWidgets.QLabel('경도', self)
        self.txt_lng = QtWidgets.QLineEdit()
        self.txt_lng.setReadOnly(True)
        self.txt_lng.setStyleSheet(style_sheet2)
        self.label_windspeed = QtWidgets.QLabel('기본풍속', self)
        self.txt_windspeed = QtWidgets.QLineEdit()
        self.label_unit_windspeed = QtWidgets.QLabel('m/s', self)
        spacerItem2 = QtWidgets.QSpacerItem(100, 10, QtWidgets.QSizePolicy.Policy.Expanding, QtWidgets.QSizePolicy.Policy.Minimum)
        

        layout_latlng.addWidget(self.label_lat)
        layout_latlng.addWidget(self.txt_lat)
        layout_latlng.addWidget(self.label_lng)
        layout_latlng.addWidget(self.txt_lng)
        layout_latlng.addSpacerItem(spacerItem2)
        layout_latlng.addWidget(self.label_windspeed)
        layout_latlng.addWidget(self.txt_windspeed)
        layout_latlng.addWidget(self.label_unit_windspeed)


        layout_markermap.addWidget(self.map)
        layout_markermap.addLayout(layout_address)
        layout_markermap.addLayout(layout_latlng)
        spacerItem1 = QtWidgets.QSpacerItem(300, 10, QtWidgets.QSizePolicy.Policy.Minimum, QtWidgets.QSizePolicy.Policy.Expanding)
        layout_markermap.addSpacerItem(spacerItem1)
        '''----------------------------------------------------------------------------------------------------------'''
        # KDS풍속 지도
        self.windmap = QtWidgets.QLabel()
        self.windmap.setPixmap(QtGui.QPixmap('form\windmap.png'))
      
        # 전체 Layout 정렬
        layout_main.addLayout(layout_Input)
        layout_main.addLayout(layout_markermap)
        layout_main.addWidget(self.windmap)

                      
    # 위도 경도 불러오기     
    def getLoc(self,addr):    
        try:
            # API 키는 환경 변수에서 로드 (보안)
            import os
            api_key = os.getenv('GOOGLE_MAPS_API_KEY')
            if not api_key:
                QtWidgets.QMessageBox.warning(
                    self, 
                    'API 키 없음', 
                    'Google Maps API 키가 설정되지 않았습니다.\n'
                    '환경 변수 GOOGLE_MAPS_API_KEY를 설정하거나\n'
                    'config/api_key.txt 파일에 API 키를 저장하세요.'
                )
                return 0, 0
            gmaps = googlemaps.Client(key=api_key)  
            geocode_result = gmaps.geocode(addr)   

            if geocode_result:
                n_lat = geocode_result[0]['geometry']['location']['lat']
                n_lng = geocode_result[0]['geometry']['location']['lng']
                self.txt_lng.setText(str(n_lng))
                self.txt_lat.setText(str(n_lat))
                return n_lat, n_lng
            else:
                QtWidgets.QMessageBox.warning(self, '오류', '주소를 찾을 수 없습니다.')
                return 0, 0
        except IndexError:
            QtWidgets.QMessageBox.warning(self, '오류', '검색 결과가 없습니다.')
            return 0, 0
        except Exception as e:
            QtWidgets.QMessageBox.warning(self, '오류', f'오류 발생: {str(e)}')
            return 0, 0

    # 지도에 마커 표시
    def change_circle(self):
        
        self.address = self.txt_address.text()
        if self.address == "": pass
        else: 
            loc = self.getLoc(self.address)
           
        self.m = folium.Map(location=[36.111470, 128.397285], zoom_start=7, tiles='cartodbpositron')
 
        rfile = open('form\skorea_municipalities_geo_simple.json', 'r', encoding = 'utf-8').read()
        jsonData = json.loads(rfile)
        folium.GeoJson(jsonData, name='json_data', style_function=self.default_style_function).add_to(self.m)

        folium.CircleMarker(loc, radius=15, color = '#B90E0A').add_to(self.m)
        folium.CircleMarker(loc, radius=1, color = '#B90E0A').add_to(self.m)

        data = io.BytesIO()
        self.m.save(data, close_file=False)
        self.map.setHtml(data.getvalue().decode())
        
            
    # 스타일 함수(folium)        
    def default_style_function(self,feature):
        return {
            'color': 'gray',  # 선의 색상을 파란색으로 지정
            'weight': 1  # 선의 두께를 2로 지정
        }
     
        
        
     

    



        
class Page_EL(QtWidgets.QWidget):
    def __init__(self, main_window, parent=None):
        self.main_window = main_window
        super().__init__(parent)

        self.label = QtWidgets.QLabel("준비중", parent=self)

        layout = QtWidgets.QVBoxLayout(self)
        layout.addWidget(self.label)

class Page_LC(QtWidgets.QWidget):
    def __init__(self, main_window, parent=None):
        self.main_window = main_window
        super().__init__(parent)

        self.label = QtWidgets.QLabel("준비중", parent=self)

        layout = QtWidgets.QVBoxLayout(self)
        layout.addWidget(self.label)




if __name__ == "__main__":
    import sys
    app = QtWidgets.QApplication(sys.argv)
    MainWindow = QtWidgets.QMainWindow()
    ui = Ui_MainWindow()
    ui.setupUi(MainWindow)
    MainWindow.show()
    sys.exit(app.exec())
